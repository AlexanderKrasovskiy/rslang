(()=>{"use strict";var t,e={887:()=>{var t;(t=jQuery)((()=>{t(".sidenav").sidenav(),t(".parallax").parallax(),t(".dropdown-trigger").dropdown(),t(".collapsible").collapsible(),t(".scrollspy").scrollSpy(),t(".tooltipped").tooltip()}))},470:(t,e,s)=>{s(887),s(747);const a=(t,e,s,a,i)=>{const n=document.createElement(t);return e&&(n.className=e),s&&(n.innerText=s),a&&(n.id=a),i&&n.setAttribute("disabled",""),n};var i,n,o,l,r,d,h;!function(t){t.main="main",t.login="login",t.register="register",t.book="book",t.audio="audio",t.sprint="sprint",t.phrase="phrase",t.stats="stats"}(i||(i={}));class p{constructor(t){this.header=a("header","header"),this.main=t,this.footer=a("footer","footer")}render(t){this.header.innerHTML=`\n<ul id="dropdown1" class="dropdown-content">\n<li><a href="#${i.sprint}">Спринт</a></li>\n<li class="divider"></li>\n<li><a href="#${i.audio}">Аудиовызов</a></li>\n<li class="divider"></li>\n<li><a href="#${i.phrase}">Фразы</a></li>\n</ul>\n\n<div class = "header-lang">\n<nav class = "nav-lang">\n<div class="nav-wrapper">\n  <a href="#${i.main}" class="logo-lang hide-on-med-and-down"></a>\n  <ul class="right">\n    <li><a href="#${i.main}" class = "menu-link-lang">На главную</a></li>\n    <li><a href="#${i.book}#0#0" class = "menu-link-lang">Учебник</a></li>\n    <li><a href="#${i.stats}" class = "menu-link-lang">Статистика</a></li>\n    <li><a class="dropdown-trigger menu-link-lang" href="#!" data-target="dropdown1">Игры<i class="material-icons right">arrow_drop_down</i></a></li>\n    <li><a href="#${i.login}" id="lang_login_btn" class = "menu-link-lang">Вход</a></li>\n  </ul>\n</div>\n</nav>\n</div>`,this.footer.innerHTML='\n\x3c!--- <div class="page-footer page-footer-lang">  ---\x3e\n\x3c!--- <div class="footer-copyright page-footer page-footer-lang"> ---\x3e\n    <div class="container">\n        <a href="https://rs.school/js/" class="grey-text text-lighten-4 left">\n            <div class="page-footer__logo"></div>\n        </a>\n        <div class="page-footer__github-wrap right">\n        <a href="https://github.com/AlexanderKrasovskiy">\n        <div class="page-footer__github"></div>\n    </a>\n    <p>Alexander Krasovskiy</p>\n        <a href="https://github.com/ALLaTk">\n        <div class="page-footer__github"></div>\n    </a>\n    <p>Alla Tkachuk</p>\n        <a href="https://github.com/Svt1108">\n        <div class="page-footer__github"></div>\n    </a>\n    <p>Svetlana Pozina, 2022</p>\n        </div>\n    </div>\n    \x3c!---</div> ---\x3e\n</div>',["audio","sprint","phrase"].includes(t)&&this.hideFooter(),document.body.append(this.header,this.main,this.footer),this.loginBtn=this.header.querySelector("#lang_login_btn"),this.loginBtn.onclick=t=>this.handleExitClick(t)}updateLoginBtnText(t){this.loginBtn&&t.logged?this.loginBtn.innerText="Выйти":this.loginBtn&&(this.loginBtn.innerText="Вход")}handleExitClick(t){let{innerText:e}=this.loginBtn;if("Выйти"===e){t.preventDefault(),localStorage.removeItem("user"),e="Вход";const[s]=window.location.hash.slice(1).split("#");s===i.main?window.location.hash="":window.location.hash=i.main,M.toast({html:"Уже уходишь? Очень жаль :("})}}hideFooter(){this.footer.style.display="none"}showFooter(){this.footer.style.display="block"}cleanAppBody(){this.header.remove(),this.main.remove(),this.footer.remove(),document.body.innerHTML="",document.body.append(this.header,this.main,this.footer)}}class c{constructor(t){this.mainDiv=t}render(){this.mainDiv.innerHTML='<div id="index-banner" class="parallax-container valign-wrapper top-img-lang">\n    <div class="section no-pad-bot">\n      <div class="container">\n        <br><br>\n        <h2 class="header center white-text h2-lang">English train</h2>\n        <div class="row center">\n          <h5 class="header light h5-lang">Твой друг в мире английского языка</h5>\n        </div>\n        <br><br>\n      </div>\n    </div>\n       <div class="parallax"><img src="assets/images/train.jpg" alt="train" class = "img-parallax"></div>\n  </div>\n\n  <div class="container">\n    <div class="section">\n     <div class="row">\n      <div class="col s12">\n        <h4 class = "center">О приложении</h4>\n        <p class="center main-text-lang">\n        <span class = "about-app-phrase1">Можно ли выучить английский, играя? Да, легко! <br></span>\n        <span class = "about-app-phrase3">Преимущества - с нами быстро, просто, весело<br></span>\n        <span class = "about-app-phrase4">Всего 15 минут в день и ты заговоришь, как носитель<br></span>\n        <span class = "about-app-phrase2">Осторожно! Вызывает привыкание<br></span>\n        </p>\n\n      <div class = " about-app-wrap">\n        <div class="about-app-wrap__small">\n          <div class = "card about-app-book">\n           <div class="about-app-title-btn">\n             <div class="about-app-title">Учебник</div>\n             <div id = "book" ></div>\n           </div>\n\n             <ul class="ul-main">\n               <li class="grey-text text-darken-2 list-lang"> более 3,5 тысяч часто употребляемых слов</li>\n               <li class="grey-text text-darken-2 list-lang"> разделы по уровню сложности</li>\n               <li class="grey-text text-darken-2 list-lang"> удобная навигация</li>\n               <li class="grey-text text-darken-2 list-lang"> озвучка, картинка-ассоциация, примеры</li>\n               <li class="grey-text text-darken-2 list-lang"> персональный раздел для сложных слов</li>\n             </ul>\n\n          </div>\n\n          <div class = "card about-app-stat">\n           <div class="about-app-title-btn">\n             <div class="about-app-title">Статистика</div>\n             <div id = "stat" ></div>\n           </div>\n             <ul class="">\n               <li class="grey-text text-darken-2 list-lang"> даёт возможность оценить прогресс в учёбе</li>\n               <li class="grey-text text-darken-2 list-lang"> мотивирует тебя идти вперед и не останавливаться</li>\n             </ul>\n           </div>\n        </div>\n\n        <div class = "card about-app-games">\n        <div class="about-app-title-btn">\n          <div class="about-app-title about-app-title_games">Игры</div>\n        </div>\n         <div class="about-app-games-list"> \n          <ul>\n            <li class="grey-text text-darken-2 list-lang"> Спринт - поможет запомнить слова, научит мгновенно переводить</li>\n            <li class="grey-text text-darken-2 list-lang"> Аудиовызов - разовьет твои навыки аудирования</li>\n            <li class="grey-text text-darken-2 list-lang"> Фразы - научит использовать слова в контексте предложения</li>\n          </ul>\n         </div> \n        <div id = "games" class = "main-games"></div>\n       </div>\n\n      </div>\n      </div>\n      </div>\n      </div>\n      </div>\n\n  <div class="parallax-container valign-wrapper">\n    <div class="section no-pad-bot">\n      <div class="container">\n        <div class="row center">\n          <h5 class="header light h5-lang">Твой друг в мире английского языка</h5>\n        </div>\n      </div>\n    </div>\n    <div class="parallax"><img src="assets/images/big-ben-2.jpg" alt="big ben" class = "img-parallax"></div>\n  </div>\n\n  <div class="container">\n    <div class="section">\n\n      <div class="row">\n      <h4 class="center">О нас</h4>\n        <div class="col s12 m4">\n          <div class="icon-block">\n            <h2 class="center avatar-wrap"><div class="alexander"></div></h2>\n            <h5 class="center main-github">Саша\n              <a href="https://github.com/AlexanderKrasovskiy" class = "main-github__link">\n                <div class="main-github__image"></div>\n              </a>\n            </h5>\n            <div class="lang_team_tags">\n              <div class="chip">Teamlead</div>\n              <div class="chip">Frontend</div>\n            </div>\n            <p class="light team-info">Разработчик. Создал архитектуру приложения.\n            Разработал роутинг, страницы входа и регистрации, авторизацию пользователей с автопродлением.\n            Собрал статистику со всего проекта и объединил её на странице статистики.\n            Сделал часть методов API.\n            </p>\n          </div>\n        </div>\n\n        <div class="col s12 m4">\n          <div class="icon-block">\n            <h2 class="center avatar-wrap avatar-wrap-alla"><div class="alla"></div></h2>\n            <h5 class="center main-github">Алла\n              <a href="https://github.com/ALLaTk" class = "main-github__link">\n                <div class="main-github__image"></div>\n              </a>\n            </h5>\n            <div class="lang_team_tags">\n              <div class="chip">Backend</div>\n              <div class="chip">Frontend</div>\n            </div>\n            <p class="light team-info">Разработчик. Обеспечила команду данными: полностью настроила бэк-энд и победила API.\n            Разработала две игры с анимацией и звуковым оформлением: "Спринт" для тех, кто хочет попробовать себя\n            в скорости угадывания слов и "Аудиовызов" для тренировки звукового восприятия. </p>\n            </div>\n        </div>\n\n        <div class="col s12 m4">\n          <div class="icon-block">\n            <h2 class="center avatar-wrap"><div class="svetlana"></div></h2>\n            <h5 class="center main-github">Светлана\n              <a href="https://github.com/Svt1108" class = "main-github__link">\n                <div class="main-github__image"></div>\n              </a>\n            </h5>\n            <div class="lang_team_tags">\n              <div class="chip">Design</div>\n              <div class="chip">Frontend</div>\n            </div>\n            <p class="light team-info">Разработчик и по совместительству дизайнер проекта. Сделала главную страницу,\n            панель навигации, учебник со всеми 3600 словами и разноцветными страничками, а также бонусную игру "Фразы",\n            в которой можно потренироваться подбирать слова к нужному контексту.</p>\n            </div>\n        </div>\n      </div>\n\n    </div>\n  </div>\n\n  <div class="parallax-container valign-wrapper">\n     <div class="container">\n       <div class="row center">\n          <h5 class="header light h5-lang center">Твой друг в мире английского языка</h5>\n       </div>\n      </div>   \n    <div class="parallax"><img src="assets/images/castle.jpg" alt="castle" class = "img-parallax"></div>\n  </div>';const t=document.getElementById("games"),e=a("a","main-btn z-depth-2 waves-effect waves-teal");e.href="#sprint",t.appendChild(e);const s=a("div","game-title"," ");e.appendChild(s);const i=a("div","game-picture btn-sprint");e.appendChild(i);const n=a("a","main-btn z-depth-2 waves-effect waves-teal");n.href="#audio",t.appendChild(n);const o=a("div","game-title"," ");n.appendChild(o);const l=a("div","game-picture btn-audio");n.appendChild(l);const r=a("a","main-btn z-depth-2 waves-effect waves-teal");r.href="#phrase",t.appendChild(r);const d=a("div","game-title"," ");r.appendChild(d);const h=a("div","game-picture btn-collection");r.appendChild(h);const p=document.getElementById("book"),c=a("a","main-btn z-depth-2 waves-effect waves-teal");c.href="#book",p.appendChild(c);const u=a("div","game-title"," ");c.appendChild(u);const m=a("div","game-picture btn-book");c.appendChild(m);const g=document.getElementById("stat"),v=a("a","main-btn z-depth-2 waves-effect waves-teal");v.href="#stats",g.appendChild(v);const w=a("div","game-title"," ");v.appendChild(w);const f=a("div","game-picture btn-stat");v.appendChild(f)}}class u{constructor(t){this.mainDiv=t,this.view=new c(t)}show(){this.view.render()}}(h=n||(n={})).words="/words",h.users="/users",h.aggregatedWords="/aggregatedWords",h.statistics="/statistics",h.settings="/settings",h.signin="/signin",h.tokens="/tokens",(d=o||(o={})).get="GET",d.create="POST",d.update="PUT",d.delete="DELETE",d.updatePatch="PATCH",function(t){t[t.difficult=0]="difficult",t[t.easy=1]="easy"}(l||(l={})),function(t){t[t.yes=0]="yes",t[t.no=1]="no"}(r||(r={}));const m="https://reactrs.onrender.com",g=async(t=0,e=0)=>{const s=`${m}${n.words}?page=${t}&group=${e}`,a=await fetch(s);return await a.json()},v=async(t,e)=>{const s=t.map((t=>fetch(`${m}${n.words}?page=${t}&group=${e}`)));return Promise.all(s).then((t=>t)).then((t=>Promise.all(t.map((t=>t.json()))))).then((t=>t.reduce(((t,e)=>(t.push(e),t.flat(1/0))),[])))},w=async(t,e)=>{let s=t;const a=[];for(;s>=0;)a.push(fetch(`${m}${n.words}?page=${s}&group=${e}`)),s-=1;return Promise.all(a).then((t=>t)).then((t=>Promise.all(t.map((t=>t.json()))))).then((t=>t.reduce(((t,e)=>(t.push(e),t.flat(1/0))),[])))},f=async(t,e,s,a)=>{const i=await fetch(`${m}${n.users}/${t}${n.words}/${e}`,{method:o.create,headers:{Authorization:`Bearer ${s}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)});return await i.json()},b=async(t,e)=>{const s=await fetch(`${m}${n.users}/${t}${n.words}`,{method:o.get,headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});return await s.json()},y=async(t,e,s,a)=>{const i=await fetch(`${m}${n.users}/${t}${n.words}/${e}`,{method:o.update,headers:{Authorization:`Bearer ${s}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)});return await i.json()},k=async(t,e)=>{const s=encodeURIComponent(JSON.stringify({"userWord.difficulty":"difficult"})),a=`${m}${n.users}/${t}${n.aggregatedWords}?page=0&wordsPerPage=3600&filter=${s}`,i=await fetch(a,{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});return await i.json()};class _{constructor(t,e,s){const i=localStorage.getItem("user");this.data=e,this.card=a("div","card z-depth-2"),t.appendChild(this.card);const n=a("div","word-img-wrap");this.card.appendChild(n),this.difficult=a("div","difficult tooltipped"),i&&6!==s&&(this.data.difficulty&&"difficult"===this.data.difficulty?this.difficult.style.backgroundImage="url(./assets/svg/difficult-colored.svg)":this.difficult.style.backgroundImage="url(./assets/svg/difficult.svg)",this.difficult.setAttribute("data-position","left"),this.difficult.setAttribute("data-tooltip","Сложно!"),n.appendChild(this.difficult)),this.learn=a("div","learn tooltipped"),i&&6!==s&&(this.data.optional&&"yes"===this.data.optional.learned?this.learn.style.backgroundImage="url(./assets/svg/learn-colored.svg)":this.learn.style.backgroundImage="url(./assets/svg/learn.svg)",this.learn.setAttribute("data-position","right"),this.learn.setAttribute("data-tooltip","Изучено :)"),n.appendChild(this.learn)),this.diffDifficultLevel=a("div","diff-difficult-level tooltipped"),i&&6===s&&(this.diffDifficultLevel.style.backgroundImage="url(./assets/svg/difficult-colored.svg)",this.diffDifficultLevel.setAttribute("data-position","left"),this.diffDifficultLevel.setAttribute("data-tooltip","Не сложно!"),n.appendChild(this.diffDifficultLevel)),this.learnDifficultLevel=a("div","learn-difficult-level tooltipped"),i&&6===s&&(this.learnDifficultLevel.style.backgroundImage="url(./assets/svg/learn.svg)",this.learnDifficultLevel.setAttribute("data-position","right"),this.learnDifficultLevel.setAttribute("data-tooltip","Изучено :)"),n.appendChild(this.learnDifficultLevel));const o=a("div","words-wrap");n.appendChild(o),this.word=a("p","grey-text text-darken-2 word",`${this.data.word}`),o.appendChild(this.word);const l=a("p","grey-text text-darken-2 p-lang",`${this.data.transcription}`);o.appendChild(l),this.volume=a("i","tiny material-icons volume-up","volume_up"),l.appendChild(this.volume),this.audio=a("audio",""),this.audio.src=`${m}/${this.data.audio}`,this.volume.appendChild(this.audio),this.audioMeaning=a("audio",""),this.audioMeaning.src=`${m}/${this.data.audioMeaning}`,this.volume.appendChild(this.audioMeaning),this.audioExample=a("audio",""),this.audioExample.src=`${m}/${this.data.audioExample}`,this.volume.appendChild(this.audioExample);const r=a("p","grey-text text-darken-2 word-translate");r.innerHTML=`${this.data.wordTranslate}`,o.appendChild(r);const d=a("div","z-depth-1 card-image");d.style.backgroundImage=`url(${m}/${this.data.image})`,n.appendChild(d);const h=a("div","card-content");this.card.appendChild(h);const p=a("p","grey-text text-darken-2 meaning p-lang","Значение:");h.appendChild(p);const c=a("p","grey-text text-darken-2 p-lang");c.innerHTML=this.data.textMeaning,h.appendChild(c);const u=a("p","grey-text text-darken-2 p-lang",`${this.data.textMeaningTranslate}`);h.appendChild(u);const g=a("div","divider divider-lang");h.appendChild(g);const v=a("p","grey-text text-darken-2 example p-lang","Пример:");h.appendChild(v);const w=a("p","grey-text text-darken-2 p-lang");w.innerHTML=this.data.textExample,h.appendChild(w);const f=a("p","grey-text text-darken-2 p-lang",`${this.data.textExampleTranslate}`);if(h.appendChild(f),i){const t=a("div","word-progress");t.innerHTML=`  <ul class="collapsible collapsible-lang">\n    <li>\n      <div class="collapsible-header collapsible-header-lang"><i class="material-icons grey-text text-darken-2">add_circle_outline</i>Статистика в играх</div>\n      <div class="collapsible-body collapsible-body-lang"><span>Спринт: ${void 0===this.data.optional?.games.sprint.wins?0:this.data.optional?.games.sprint.wins}/ ${void 0===this.data.optional?.games.sprint.total?0:this.data.optional?.games.sprint.total}<br>\n      Аудиовызов: ${void 0===this.data.optional?.games.audio.wins?0:this.data.optional?.games.audio.wins}/ ${void 0===this.data.optional?.games.audio.total?0:this.data.optional?.games.audio.total}<br>\n      Фразы: ${void 0===this.data.optional?.games.phrase.wins?0:this.data.optional?.games.phrase.wins}/ ${void 0===this.data.optional?.games.phrase.total?0:this.data.optional?.games.phrase.total}</span></div>\n    </li>\n    </ul>`,h.appendChild(t)}this.setListeners()}setListeners(){this.volume.onclick=()=>this.onVolume?.(),this.difficult.onclick=()=>this.onDifficult?.(),this.learn.onclick=()=>this.onLearn?.(),this.learnDifficultLevel.onclick=()=>this.onLearnDifficultLevel?.(),this.diffDifficultLevel.onclick=()=>this.onDiffDifficultLevel?.()}}const x=async(t,e,s)=>{const a=`${m}${n.users}/${t}${n.statistics}`,i=await fetch(a,{method:o.update,headers:{Accept:"application/json",Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(s)});return await i.json()},$=new class{async handleOnLearn({optional:t}){const e=await this.getOrCreateUserStats(),s=this.createDateStr();if(t){const{learned:a,learnDate:i}=t;if("yes"===a){const t=this.createDateStr(i);e.optional.long[t].learnedWords-=1}else e.optional.long[s].learnedWords+=1}else e.optional.long[s].learnedWords+=1;const{id:a,token:i}=this.getStorageUserData();await x(a,i,e)}async handleOnDifficult({optional:t}){if(t){const{learned:e,learnDate:s}=t;if("yes"===e){const t=await this.getOrCreateUserStats(),e=this.createDateStr(s);t.optional.long[e].learnedWords-=1;const{id:a,token:i}=this.getStorageUserData();await x(a,i,t)}}}async postPhraseResults(t,e){const s=localStorage.getItem("user");if(!s)return;const a=await this.getOrCreateUserStats(),i=this.createDateStr();t.forEach((t=>{const{optional:e,difficulty:s}=t;if(e){const{games:t}=e,{total:n,wins:o}=t.phrase;(o+1)%5==0&&"difficult"===s&&(a.optional.long[i].learnedWords+=1),(o+1)%3==0&&"normal"===s&&(a.optional.long[i].learnedWords+=1);const{audio:l,sprint:r}=t;0===n+l.total+r.total&&(a.optional.today.phrase.newWords+=1,a.optional.long[i].newWords+=1),a.optional.today.phrase.wins+=1,a.optional.today.phrase.total+=1}else a.optional.today.phrase.newWords+=1,a.optional.long[i].newWords+=1,a.optional.today.phrase.wins+=1,a.optional.today.phrase.total+=1})),e.forEach((t=>{const{optional:e}=t;if(e){const{learned:t,learnDate:s,games:n}=e,{total:o}=n.phrase;if("yes"===t){const t=this.createDateStr(s);a.optional.long[t].learnedWords-=1}const{audio:l,sprint:r}=n;0===o+l.total+r.total&&(a.optional.today.phrase.newWords+=1,a.optional.long[i].newWords+=1),a.optional.today.phrase.total+=1}else a.optional.today.phrase.newWords+=1,a.optional.long[i].newWords+=1,a.optional.today.phrase.total+=1}));const n=Math.max(t.length,a.optional.today.phrase.bestSeries);a.optional.today.phrase.bestSeries=n;const{id:o,token:l}=JSON.parse(s);await x(o,l,a)}async postWrong(t){const e=t,{optional:s}=e,a=await this.getOrCreateUserStats(),i=this.createDateStr(),n=window.location.hash.slice(1).split("#")[0];if(s){const{learnDate:t,learned:e,games:o}=s;if("yes"===e){const e=this.createDateStr(t);a.optional.long[e].learnedWords-=1}const[l,r,d]=Object.values(o);0===l.total+r.total+d.total&&(a.optional.today[n].newWords+=1,a.optional.long[i].newWords+=1),a.optional.today[n].total+=1}else a.optional.today[n].newWords+=1,a.optional.long[i].newWords+=1,a.optional.today[n].total+=1;const{id:o,token:l}=this.getStorageUserData();await x(o,l,a)}async postCorrect(t){const e=t,{optional:s,difficulty:a}=e,i=await this.getOrCreateUserStats(),n=this.createDateStr(),o=window.location.hash.slice(1).split("#")[0];if(s){const{games:t}=s,{wins:e}=t[o];(e+1)%5==0&&"difficult"===a&&(i.optional.long[n].learnedWords+=1),(e+1)%3==0&&"normal"===a&&(i.optional.long[n].learnedWords+=1);const[l,r,d]=Object.values(t);0===l.total+r.total+d.total&&(i.optional.today[o].newWords+=1,i.optional.long[n].newWords+=1),i.optional.today[o].wins+=1,i.optional.today[o].total+=1}else i.optional.today[o].newWords+=1,i.optional.long[n].newWords+=1,i.optional.today[o].wins+=1,i.optional.today[o].total+=1;const{id:l,token:r}=this.getStorageUserData();await x(l,r,i)}async postBestSeries(t){if(!t)return;if(!localStorage.getItem("user"))return;const e=await this.getOrCreateUserStats();e.optional.dateToday=this.createDateStr();const[s]=window.location.hash.slice(1).split("#"),a=Math.max(t,e.optional.today[s].bestSeries);e.optional.today[s].bestSeries=a;const{id:i,token:n}=this.getStorageUserData();await x(i,n,e)}createDateStr(t){let e;e=t?new Date(t):new Date;const s=`${e.getFullYear()}`.slice(2),a=e.getMonth()+1;return`${e.getDate()}.${a}.${s}`}createDefaultStatsObj(){const t=this.createDateStr();return{learnedWords:0,optional:{dateToday:t,today:{sprint:{newWords:0,bestSeries:0,wins:0,total:0},audio:{newWords:0,bestSeries:0,wins:0,total:0},phrase:{newWords:0,bestSeries:0,wins:0,total:0}},long:{[t]:{newWords:0,learnedWords:0}}}}}getStorageUserData(){const t=localStorage.getItem("user");return JSON.parse(`${t}`)}async getOrCreateUserStats(){const{id:t,token:e}=this.getStorageUserData(),{stats:s}=await(async(t,e)=>{const s=`${m}${n.users}/${t}${n.statistics}`,a=await fetch(s,{headers:{Authorization:`Bearer ${e}`}}),{ok:i,status:o}=a;let l;return i&&(l=await a.json()),{ok:i,code:o,stats:l}})(t,e);let a;return s?(a=s,this.checkDateToDropDayStats(a),delete a.id):a=this.createDefaultStatsObj(),a}checkDateToDropDayStats(t){const e=t,s=this.createDateStr();e.optional.dateToday!==s&&(e.optional.today.sprint={newWords:0,bestSeries:0,wins:0,total:0},e.optional.today.audio={newWords:0,bestSeries:0,wins:0,total:0},e.optional.today.phrase={newWords:0,bestSeries:0,wins:0,total:0},e.optional.long[s]={newWords:0,learnedWords:0},e.optional.dateToday=s)}async getStats(){return await this.getOrCreateUserStats()}getDefaultStats(){return this.createDefaultStatsObj()}},L=20;class T{constructor(t){this.userRes=[],this.audioElems=[],this.mainDiv=t,this.pageNumber=0,this.levelNumber=0,this.learnAndDifficult=0,this.lastPageNumber=29}render(t,e,s,i,n){this.userRes=t,(n||0===n)&&(this.learnAndDifficult=n);for(let t=0;t<this.audioElems.length;t+=1)this.audioElems[t].removeAttribute("src"),this.audioElems[t].srcObject=null,this.audioElems[t].remove();this.audioElems=[],this.mainDiv.innerHTML="",void 0!==e&&(this.levelNumber=e),void 0!==s&&(this.pageNumber=s);const o=a("div","book-wrap","","book-wrap");this.mainDiv.appendChild(o);const l=a("div","parallax-container valign-wrapper title-lang");l.innerHTML='    <div class="section no-pad-bot title-lang-mobile">\n      <div class="container">\n        <h6 class="header center white-text h6-lang">Учебник. Multilevel coursebook</h6>\n      </div>\n    </div>\n \n     <div class="parallax"><img src="" alt="violet" class = "img-parallax" id = "img-1"></div>',o.appendChild(l);const r=a("div","section");o.appendChild(r);const d=a("div","row");r.appendChild(d);const h=a("div","col s12 m2 levels");d.appendChild(h),i?this.renderLevels(h,i):this.renderLevels(h);const p=a("div","col s12 m8 cards-wrap");if(d.appendChild(p),6!==this.levelNumber){const t=a("div","pagination-top");p.appendChild(t),this.renderPagination(t,"top")}if(this.cards=a("div","cards"),p.appendChild(this.cards),i?this.renderCards(this.userRes,i):this.renderCards(this.userRes),this.games=a("div","col s12 m2 games"),d.appendChild(this.games),this.renderGames(this.games),6!==this.levelNumber){const t=a("div","pagination");o.appendChild(t),this.renderPagination(t,"bottom")}const c=a("div","parallax-container valign-wrapper bottom-lang");c.innerHTML='\n     <div class="parallax"><img src="" alt="violet" class = "img-parallax" id = "img-3"></div>',o.appendChild(c),void 0!==e&&this.switchImages(e),this.learnedMessage=a("div","learned-message","Cлова на этой странице изучены!"),o.appendChild(this.learnedMessage),i&&this.learnAndDifficult===L&&6!==this.levelNumber&&this.changePageStyle("learned"),6===this.levelNumber&&0===t.length&&(this.games.style.pointerEvents="none",this.games.classList.add("non-acceptable"))}renderLevels(t,e){const s=a("h6","levels-title center","Разделы");t.appendChild(s);const i=a("div","level-btn z-depth-2 waves-effect waves-purple violet-border","A1");t.appendChild(i),i.onclick=()=>this.switchLevel(0);const n=a("div","level-btn z-depth-2 waves-effect waves-yellow yellow-border","A2");t.appendChild(n),n.onclick=()=>this.switchLevel(1);const o=a("div","level-btn z-depth-2 waves-effect waves-green green-border","B1");t.appendChild(o),o.onclick=()=>this.switchLevel(2);const l=a("div","level-btn z-depth-2 waves-effect waves-teal blue-border","B2");t.appendChild(l),l.onclick=()=>this.switchLevel(3);const r=a("div","level-btn z-depth-2 waves-effect waves-orange orange-border","C1");t.appendChild(r),r.onclick=()=>this.switchLevel(4);const d=a("div","level-btn z-depth-2 waves-effect waves-red red-border","C2");if(t.appendChild(d),d.onclick=()=>this.switchLevel(5),e){const e=a("div","level-btn level-btn-difficult z-depth-2 waves-effect waves-light white-border","Сложные слова");t.appendChild(e),e.onclick=()=>this.switchLevel(6)}}renderGames(t){const e=a("h6","games-title center","Игры");t.appendChild(e);const s=a("a","games-btn z-depth-2 waves-effect");s.href=`#sprint#${this.levelNumber}#${this.pageNumber}`,t.appendChild(s);const i=a("div","game-title","Спринт");s.appendChild(i);const n=a("div","game-picture btn-sprint");s.appendChild(n);const o=a("a","games-btn z-depth-2 waves-effect");o.href=`#audio#${this.levelNumber}#${this.pageNumber}`,t.appendChild(o);const l=a("div","game-title","Аудиовызов");o.appendChild(l);const r=a("div","game-picture btn-audio");o.appendChild(r);const d=a("a","games-btn z-depth-2 waves-effect");d.href=`#phrase#${this.levelNumber}#${this.pageNumber}`,t.appendChild(d);const h=a("div","game-title","Фразы");d.appendChild(h);const p=a("div","game-picture btn-collection");d.appendChild(p)}switchLevel(t){this.levelNumber!==t&&(window.location.hash=`${i.book}#${t}#0`)}switchImages(t){let e="";const s=document.getElementById("img-1"),a=document.getElementById("img-3"),i=document.getElementById("book-wrap");0===t&&(e="violet"),1===t&&(e="yellow"),2===t&&(e="green"),3===t&&(e="blue"),4===t&&(e="orange"),5===t&&(e="red"),6===t&&(e="white"),s.src=`assets/images/${e}-1.jpg`,a.src=`assets/images/${e}-3.jpg`,i.style.backgroundImage=`url(./assets/images/${e}-2.jpg)`}renderPagination(t,e){const s=a("div","page-wrap");t.appendChild(s);const i=a("div","page-btn z-depth-1 waves-effect first","<<");s.appendChild(i),i.onclick=()=>this.changePageNumber("first");const n=a("div","page-btn z-depth-1 waves-effect previous","<");s.appendChild(n),n.onclick=()=>this.changePageNumber("prev"),"top"===e?(this.pageNumberViewTop=a("div","page-number",`${this.pageNumber}`),this.pageNumberViewTop.setAttribute("readonly","readonly"),s.appendChild(this.pageNumberViewTop),this.pageNumberViewTop.innerHTML=(this.pageNumber+1).toString()):(this.pageNumberViewBottom=a("div","page-number",`${this.pageNumber}`),this.pageNumberViewBottom.setAttribute("readonly","readonly"),s.appendChild(this.pageNumberViewBottom),this.pageNumberViewBottom.innerHTML=(this.pageNumber+1).toString());const o=a("div","page-btn z-depth-1 waves-effect next",">");s.appendChild(o),o.onclick=()=>this.changePageNumber("next");const l=a("div","page-btn z-depth-1 waves-effect last",">>");s.appendChild(l),l.onclick=()=>this.changePageNumber("last"),0===this.pageNumber&&(i.classList.add("btn-blocked"),i.classList.remove("waves-effect"),n.classList.add("btn-blocked"),n.classList.remove("waves-effect")),this.pageNumber===this.lastPageNumber&&(l.classList.add("btn-blocked"),l.classList.remove("waves-effect"),o.classList.add("btn-blocked"),o.classList.remove("waves-effect"))}changePageNumber(t){"next"===t&&this.pageNumber<this.lastPageNumber&&(this.pageNumber+=1),"prev"===t&&this.pageNumber>0&&(this.pageNumber-=1),"first"===t&&(this.pageNumber=0),"last"===t&&(this.pageNumber=this.lastPageNumber),this.pageNumberViewTop.innerHTML=(this.pageNumber+1).toString(),this.pageNumberViewBottom.innerHTML=(this.pageNumber+1).toString(),window.location.hash=`${i.book}#${this.levelNumber}#${this.pageNumber}`}renderCards(t,e){const s=[...document.querySelectorAll(".material-tooltip")];for(let t=0;t<s.length;t+=1)s[t].remove();if(6!==this.levelNumber||0!==t.length){for(let s=0;s<t.length;s+=1){const a=new _(this.cards,t[s],this.levelNumber),{audio:i,audioMeaning:n,audioExample:o}=a;this.audioElems.push(i,n,o),a.onVolume=()=>!1===a.audio.paused?(a.audio.pause(),a.audio.currentTime=0,void a.volume.classList.remove("volume-active")):!1===a.audioMeaning.paused?(a.audioMeaning.pause(),a.audioMeaning.currentTime=0,void a.volume.classList.remove("volume-active")):!1===a.audioExample.paused?(a.audioExample.pause(),a.audioExample.currentTime=0,void a.volume.classList.remove("volume-active")):(a.volume.classList.add("volume-active"),a.audio.play(),a.audio.onended=()=>a.audioMeaning.play(),a.audioMeaning.onended=()=>a.audioExample.play(),void(a.audioExample.onended=()=>a.volume.classList.remove("volume-active"))),a.onDifficult=async()=>{await $.handleOnDifficult(t[s]),t[s].difficulty?t[s].difficulty&&"difficult"===t[s].difficulty?(a.difficult.style.backgroundImage="url(./assets/svg/difficult.svg)",a.learn.style.backgroundImage="url(./assets/svg/learn.svg)",t[s].difficulty="normal",t[s].optional.learned="no",t[s].optional.learnDate=Date.now(),await this.makeWordNormal(t[s],e)):t[s].difficulty&&"difficult"!==t[s].difficulty&&(a.difficult.style.backgroundImage="url(./assets/svg/difficult-colored.svg)",a.learn.style.backgroundImage="url(./assets/svg/learn.svg)","normal"===t[s].difficulty&&(this.learnAndDifficult+=1,this.learnAndDifficult>=L&&this.changePageStyle("learned")),t[s].difficulty="difficult",t[s].optional.learned="no",t[s].optional.learnDate=Date.now(),await y(e.id,t[s].id,e.token,{difficulty:t[s].difficulty,optional:t[s].optional})):(a.difficult.style.backgroundImage="url(./assets/svg/difficult-colored.svg)",a.learn.style.backgroundImage="url(./assets/svg/learn.svg)",t[s].difficulty="difficult",t[s].optional={learned:"no",learnDate:Date.now(),games:{sprint:{wins:0,total:0},audio:{wins:0,total:0},phrase:{wins:0,total:0}},markedAsNew:!1},await f(e.id,t[s].id,e.token,{difficulty:t[s].difficulty,optional:t[s].optional}),this.learnAndDifficult+=1,this.learnAndDifficult>=L&&this.changePageStyle("learned"))},a.onLearn=async()=>{await $.handleOnLearn(t[s]),t[s].optional?t[s].optional&&"yes"===t[s].optional?.learned?(a.difficult.style.backgroundImage="url(./assets/svg/difficult.svg)",a.learn.style.backgroundImage="url(./assets/svg/learn.svg)",t[s].difficulty="normal",t[s].optional.learned="no",t[s].optional.learnDate=Date.now(),await this.makeWordNormal(t[s],e)):t[s].optional&&"no"===t[s].optional?.learned&&(a.difficult.style.backgroundImage="url(./assets/svg/difficult.svg)",a.learn.style.backgroundImage="url(./assets/svg/learn-colored.svg)","normal"===t[s].difficulty&&(this.learnAndDifficult+=1,this.learnAndDifficult>=L&&this.changePageStyle("learned")),t[s].difficulty="easy",t[s].optional.learned="yes",t[s].optional.learnDate=Date.now(),await y(e.id,t[s].id,e.token,{difficulty:t[s].difficulty,optional:t[s].optional})):(a.difficult.style.backgroundImage="url(./assets/svg/difficult.svg)",a.learn.style.backgroundImage="url(./assets/svg/learn-colored.svg)",t[s].difficulty="easy",t[s].optional={learned:"yes",learnDate:Date.now(),games:{sprint:{wins:0,total:0},audio:{wins:0,total:0},phrase:{wins:0,total:0}},markedAsNew:!1},await f(e.id,t[s].id,e.token,{difficulty:t[s].difficulty,optional:t[s].optional}),this.learnAndDifficult+=1,this.learnAndDifficult>=L&&this.changePageStyle("learned"))},a.onLearnDifficultLevel=async()=>{t[s].optional.learned="yes",t[s].optional.learnDate=Date.now(),a.learnDifficultLevel.style.backgroundImage="url(./assets/svg/learn-colored.svg)",await y(e.id,t[s].id,e.token,{difficulty:"easy",optional:t[s].optional}),t.splice(s,1),this.cards.innerHTML="",this.renderCards(t,e)},a.onDiffDifficultLevel=async()=>{a.diffDifficultLevel.style.backgroundImage="url(./assets/svg/difficult.svg)",await y(e.id,t[s].id,e.token,{difficulty:"normal",optional:t[s].optional}),t.splice(s,1),this.cards.innerHTML="",this.renderCards(t,e)}}M.AutoInit()}else{const t=a("p","no-difficult-card","Сложных слов нет. Для тебя всё просто :)");this.cards.appendChild(t)}}changePageStyle(t){"learned"===t?(this.learnedMessage.classList.add("non-transparent"),this.pageNumberViewTop.style.color="rgba(1, 37, 19, 0.9)",this.pageNumberViewBottom.style.color="rgba(1, 37, 19, 0.9)",this.pageNumberViewBottom.style.backgroundColor="rgba(255, 255, 255, 0.3)",this.games.style.pointerEvents="none",this.games.classList.add("non-acceptable")):(this.learnedMessage.classList.remove("non-transparent"),this.pageNumberViewTop.style.color="rgb(255, 255, 255)",this.pageNumberViewBottom.style.color="rgb(255, 255, 255)",this.pageNumberViewBottom.style.backgroundColor="",this.games.style.pointerEvents="auto",this.games.classList.remove("non-acceptable"))}async makeWordNormal(t,e){await y(e.id,t.id,e.token,{difficulty:t.difficulty,optional:t.optional}),this.learnAndDifficult-=1,this.learnAndDifficult<L&&this.changePageStyle("not-learned")}}class D{async getBookWords(t=0,e=0){return await g(e,t)}}const G=(t,e)=>{let s=0;const a=t.reduce(((t,e)=>(t[e.id]=e,t)),{});return e.forEach((({wordId:t,difficulty:e,optional:i})=>{t in a&&("difficult"!==e&&"yes"!==i.learned||(s+=1),a[t]={...a[t],difficulty:e,optional:i})})),{combinedArr:Object.values(a),num:s}};function C(t){return t.map((t=>{const e={...t,id:t._id,difficulty:t?.userWord?.difficulty,optional:t?.userWord?.optional};return delete e._id,delete e.userWord,e}))}class S{constructor(t){this.mainDiv=t,this.model=new D,this.view=new T(t)}async show(t,e){let s;if(localStorage.getItem("user")){const a=JSON.parse(localStorage.getItem("user"));if(6===t){const s=C((await k(a.id,a.token))[0].paginatedResults).sort(((t,e)=>e.optional.learnDate-t.optional.learnDate));this.view.render(s,t,e,a)}else{s=await this.model.getBookWords(t,e);const i=await b(a.id,a.token),n=G(s,i),o=n.combinedArr,l=n.num;this.view.render(o,t,e,a,l)}}else s=await this.model.getBookWords(t,e),this.view.render(s,t,e)}}const W=(t,e)=>{const s=a("div","lang_login_heading");return s.innerHTML=`${t}<br>&<br>${e}`,s},I=(t,e,s)=>{const i=a("p");return i.innerHTML=`${e} <a class="red-text text-accent-4" href="#${t}">${s}</a>`,i},N="^[a-zA-Z0-9]+(\\.[_a-zA-Z0-9]+)*@[a-zA-Z0-9-]+(\\.[a-zA-Z0-9-]+)*(\\.[a-zA-Z]{2,15})$";class R{constructor(t){this.mainDiv=t}renderLogin(){const t=a("div","lang_login"),e=a("div","lang_login_img_container lang_door"),s=a("div","lang_login_form_container");t.append(e,s);const i=W("Уже с нами?","Войди в аккаунт!"),n=a("div","row"),o=I("register","Впервые тут?","Зарегистрируйся!");s.append(i,n,o),this.form=a("form","col lang_login_form");const l=(()=>{const t=a("div","row");return t.innerHTML=`\n  <div class="input-field col s12 lang_login_input">\n    <i class="grey-text text-darken-1 material-icons prefix">mail</i>\n    <input id="mail" type="email" class="validate" name="mail" required pattern="${N}">\n    <label for="mail">e-mail *</label>\n  </div>\n\n  <div class="input-field col s12 lang_login_input lang_login_input_last">\n    <i class="grey-text text-darken-1 material-icons prefix">vpn_key</i>\n    <input id="pass" type="password" class="validate" name="pass" minlength="8" maxlength="16" required>\n    <label for="pass">пароль *</label>\n  </div>\n\n  <button class="btn waves-effect waves-green grey lighten-3 z-depth-3 btn-lang lang_login_btn" type="submit">\n    ВОЙТИ\n    <i class="material-icons right">check</i>\n  </button>\n  `,t})();this.form.append(l),n.append(this.form),this.form.onsubmit=t=>this.handleLogin(t),this.mainDiv.innerHTML="",this.mainDiv.append(t)}async handleLogin(t){t.preventDefault();const e=new FormData(this.form),s=e.get("mail")?.toString().trim(),a=e.get("pass");await(this.handleSignIn?.(`${s}`,`${a}`))}showToast(t){M.toast({html:t})}renderRegistry(){const t=a("div","lang_login"),e=a("div","lang_login_img_container lang_telephone"),s=a("div","lang_login_form_container");t.append(e,s);const i=W("Впервые тут?","Зарегистрируйся!"),n=a("div","row"),o=I("login","Уже с нами?","Войди в аккаунт!");s.append(i,n,o),this.form=a("form","col lang_login_form");const l=(()=>{const t=a("div","row");return t.innerHTML=`\n  <div class="input-field col s12 lang_login_input">\n    <i class="grey-text text-darken-1 material-icons prefix">person</i>\n    <input id="name" type="text" class="validate" name="name">\n    <label for="name">имя (опционально)</label>\n  </div>\n\n  <div class="input-field col s12 lang_login_input">\n    <i class="grey-text text-darken-1 material-icons prefix">mail</i>\n    <input id="mail_2" type="email" class="validate" name="mail" required pattern="${N}">\n    <label for="mail_2">e-mail *</label>\n  </div>\n\n  <div class="input-field col s12 lang_login_input">\n    <i class="grey-text text-darken-1 material-icons prefix">vpn_key</i>\n    <input id="pass_1" type="password" class="validate" name="pass_1" minlength="8" maxlength="16" required>\n    <label for="pass_1">пароль (от 8 до 16 символов) *</label>\n  </div>\n\n  <div class="input-field col s12 lang_login_input lang_login_input_last">\n    <i class="grey-text text-darken-1 material-icons prefix">vpn_key</i>\n    <input id="pass_2" type="password" class="validate" name="pass_2" minlength="8" maxlength="16" required>\n    <label for="pass_2">повторить пароль *</label>\n  </div>\n\n  <button class="btn waves-effect waves-green grey lighten-3 z-depth-3 btn-lang lang_login_btn" type="submit">РЕГИСТРАЦИЯ\n    <i class="material-icons right">check</i>\n  </button>\n  `,t})();this.form.append(l),n.append(this.form),this.form.onsubmit=t=>this.handleRegistry(t),this.mainDiv.innerHTML="",this.mainDiv.append(t)}async handleRegistry(t){t.preventDefault();const e=new FormData(this.form),s=e.get("name")?.toString().trim()||"Аноним",a=e.get("mail")?.toString().trim(),i=e.get("pass_1");i!==e.get("pass_2")?this.showToast("Пароли должны совпадать"):await(this.handleCreateUser?.({name:`${s}`,mail:`${a}`,pass:`${i}`}))}}class A{async sendSignIn(t,e){return await(async t=>{const e=`${m}${n.signin}`,s=await fetch(e,{method:o.create,headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}),{ok:a,status:i}=s;let l;return a&&(l=await s.json()),{ok:a,status:i,data:l}})({email:t,password:e})}saveLoginData(t,e){const s=Date.now(),a={...t,mail:e,loginTime:s,id:t.userId};delete a.message,delete a.userId,localStorage.setItem("user",JSON.stringify(a))}async sendCreateUser({name:t,mail:e,pass:s}){return await(async t=>{const e=`${m}${n.users}`,s=await fetch(e,{method:o.create,headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}),{ok:a,status:i}=s;let l;return a&&(l=await s.json()),{ok:a,status:i,data:l}})({email:e,password:s,name:t})}async sendTokenRefresh(t){const e=await(async t=>{const e=`${m}${n.users}/${t.id}${n.tokens}`,s=await fetch(e,{headers:{Authorization:`Bearer ${t.refreshToken}`}}),{ok:a,status:i}=s;let o;return a&&(o=await s.json()),{ok:a,status:i,data:o}})(t);return e}updateLoginData(t,e){const s=Date.now();if(e){const a={...t,...e,loginTime:s};localStorage.setItem("user",JSON.stringify(a))}}}const B=new class{constructor(){this.loader=a("div","progress")}show(){this.header?.append(this.loader)}hide(){this.loader.remove()}init(){this.header=document.querySelector(".header-lang"),this.loader.innerHTML='<div class="indeterminate"></div>'}};class E{constructor(t){this.loader=B,this.view=new R(t),this.model=new A,this.view.handleSignIn=this.handleSignIn.bind(this),this.view.handleCreateUser=this.handleCreateUser.bind(this)}show(t){"login"===t?this.view.renderLogin():this.view.renderRegistry()}async handleSignIn(t,e){this.loader.show();const s=await this.model.sendSignIn(t,e);s.data?(this.model.saveLoginData(s.data,t),window.location.hash="main",this.view.showToast("Успешный вход в аккаунт :)")):(this.view.showToast("Неверный логин/пароль :("),this.loader.hide())}async handleCreateUser(t){this.loader.show(),(await this.model.sendCreateUser(t)).data?(this.view.showToast("Успешная регистрация :)"),await this.handleSignIn(t.mail,t.pass)):(this.view.showToast("Этот E-mail уже зарегистрирован"),this.loader.hide())}async updateLoginStatus(){const t=localStorage.getItem("user");if(!t)return{logged:!1,kicked:!1};const e=JSON.parse(`${t}`),{loginTime:s}=e,a=(Date.now()-s)/1e3/60/60;if(a<2.4)return{logged:!0,kicked:!1};if(a<4.4){const{data:t}=await this.model.sendTokenRefresh(e);return this.model.updateLoginData(e,t),this.view.showToast("ТОКЕН обновлен ;)"),{logged:!0,kicked:!1}}return localStorage.removeItem("user"),this.view.showToast("Сервер нас забыл :( Пора зайти по-новой ;)"),{logged:!1,kicked:!0}}}class H{async getGameData(t,e){return await w(t,e)}}class O{constructor(t){this.mainDiv=t,this.stateGame=a("div","sprint_game-content"),this.controlBlock=a("div","sprint_controll"),this.againGame=a("button","waves-effect waves-light btn right-sptint-btn end","сыграть еще раз"),this.soundImg=a("button","sprint_sound"),this.sound=!0,this.fullscreen=!1,this.timeleft=60,this.points=10,this.pointsTotal=0,this.pointsTotalResult=[],this.pointsResult=[],this.learnedWords=[],this.unlearnedWords=[],this.countBestRes=0,this.bestResult=[0],this.handleKeypress=()=>{},this.downloadTimer=setTimeout((()=>{}))}render(t,e){this.controlBlock.innerHTML="",this.mainDiv.innerHTML="";const s=a("div","sprint"),i=a("img","img-sprint"),n=a("button","sprint_fullscreen"),o=a("button","sprint_cross");n.onclick=()=>{this.fullscreen?(document.exitFullscreen(),this.fullscreen=!1):(this.mainDiv.requestFullscreen(),this.fullscreen=!0)},this.soundImg.onclick=()=>{this.sound?(this.sound=!1,this.soundImg.classList.add("sprint_not-sound")):(this.sound=!0,this.soundImg.classList.remove("sprint_not-sound")),this.createSounds(this.sound)},o.onclick=()=>{window.location.hash="main",this.stopGame()},this.soundImg.onmouseout=()=>{this.soundImg.blur()},n.onmouseout=()=>{n.blur()},this.againGame.tabIndex=0,o.tabIndex=0,this.soundImg.tabIndex=0,n.tabIndex=0,s.append(i),this.controlBlock.appendChild(this.soundImg),this.controlBlock.append(n),this.controlBlock.appendChild(o),this.mainDiv.append(this.controlBlock),this.mainDiv.append(s),t&&e?(this.mainDiv.append(this.startGameFromBook(t,e)),this.againGame.onclick=()=>{this.stopGame(),this.startGameFromBook(t,e),this.sound=!0}):t&&!e?(this.mainDiv.append(this.startGameFromBook(t)),this.againGame.onclick=()=>{this.stopGame(),this.startGameFromBook(t),this.sound=!0}):!t&&e?(this.mainDiv.append(this.startGameFromMenu(e)),this.againGame.onclick=()=>{this.stopGame(),this.startGameFromMenu(e),this.sound=!0}):t||e||(this.mainDiv.append(this.startGameFromMenu()),this.againGame.onclick=()=>{this.stopGame(),this.startGameFromMenu(),this.sound=!0})}startGameFromMenu(t){this.stateGame.innerHTML="",this.pointsResult=[],this.points=10,this.pointsTotal=0,this.learnedWords=[],this.unlearnedWords=[];const e=[],s=a("h1","title-sprint h1-lang","Спринт"),i=a("h5","subtitle-sprint h5-lang","Попробуй угадать как можно больше слов за минуту"),n=a("ul","nav-sprint h6-lang","Инструкция для игры на клавиатуре:"),o=a("li","nav_list-sprint ul-lang"," - клавиши влево и вправо для выбора ответа"),l=a("div","level-sprint");for(;e.length<30;){const t=Math.floor(30*Math.random());e.includes(t)||e.push(t)}const r=["A1","A2","B1","B2","C1","C2"],d=["waves-purple violet-border","waves-yellow yellow-border","waves-green green-border","waves-teal blue-border","waves-orange orange-border","waves-red red-border"];for(let s=0;s<=5;s+=1){const i=a("button",`sprint-level-btn z-depth-2 waves-effect ${d[s]}`,`${r[s]}`);i.disabled=!1,i.onclick=async()=>{i.disabled=!0;const a=await v(e,s);if(this.stateGame.innerHTML="",this.stateGame.innerHTML="",t){const e=await b(t.id,t.token),s=G(a,e).combinedArr;this.mainDiv.append(this.showGame(s,t))}else this.mainDiv.append(this.showGame(a))},l.append(i)}return n.append(o),this.stateGame.append(s),this.stateGame.append(i),this.stateGame.append(n),this.stateGame.append(l),this.stateGame}startGameFromBook(t,e){this.stateGame.innerHTML="",this.pointsResult=[],this.points=10,this.pointsTotal=0,this.learnedWords=[],this.unlearnedWords=[];const s=a("h1","title-sprint h1-lang","Спринт"),i=a("h5","subtitle-sprint h5-lang","Попробуй угадать как можно больше слов за минуту"),n=a("ul","nav-sprint h6-lang","Инструкция для игры на клавиатуре:"),o=a("li","nav_list-sprint ul-lang"," - клавиши влево и вправо для выбора ответа"),l=a("button","sprint-start-btn z-depth-1 waves-effect","НАЧАТЬ");l.tabIndex=0;const r=t.filter((t=>!t.optional||"no"===(t.optional&&t.optional).learned));return l.disabled=!1,l.onclick=()=>{l.disabled=!0,this.stateGame.innerHTML="",r.length||(window.location.hash="book"),r.length&&e&&this.showGame(r,e),r.length&&!e&&this.showGame(r)},n.append(o),this.stateGame.append(s),this.stateGame.append(i),this.stateGame.append(n),this.stateGame.append(l),this.stateGame}showGame(t,e){this.timeleft=60;const s=(i=t).map(((t,e)=>{if(Math.random()<.5)return{audio:t.audio,en:t.word,ru:t.wordTranslate,match:!0};const s=Math.floor(Math.random()*i.length),a=s===e;return{audio:t.audio,en:t.word,ru:i[s].wordTranslate,match:a}}));var i;const n=a("div","sprint_word card"),o=a("div","sprint_word-name"),l=a("i","tiny grey-text text-darken-2 material-icons volume-up sprint-audio","volume_up"),r=a("div","sprint_crows"),d=a("div","sprint_points",`+${this.points} очков за слово`),h=a("div","sprint_total-points","0"),p=a("div","sprint_btn-block"),c=a("div","sprint_time"),u=a("div","sprint_clock"),g=a("div","sprint_seconds card",`:${this.timeleft}`),v=a("button","waves-effect waves-light btn right-sptint-btn","верно"),w=a("button","waves-effect waves-light btn left-sptint-btn","неверно"),f=a("div","sprint_crow"),b=a("div","sprint_crow"),y=a("div","sprint_crow"),k=new Audio;let _=0;return k.src=`${m}/${s[0].audio}`,l.onclick=()=>{k.play()},o.innerHTML=`${s[0].en}   -   ${s[0].ru}`,o.appendChild(l),this.downloadTimer=setInterval((()=>{g.innerHTML=`:${this.timeleft}`,this.timeleft<=0&&(clearInterval(this.downloadTimer),this.endGame()),this.timeleft-=1}),1e3),this.handleKeypress=a=>{_<s.length?("ArrowRight"===a.code&&this.rightChoice(_,s,t,f,b,y,d,h,o,k,l,e),"ArrowLeft"===a.code&&this.wrongChoice(_,s,t,f,b,y,d,h,o,k,l,e),_+=1):window.removeEventListener("keyup",this.handleKeypress)},window.addEventListener("keyup",this.handleKeypress),v.onclick=async()=>{await this.rightChoice(_,s,t,f,b,y,d,h,o,k,l,e),_+=1},w.onclick=async()=>{await this.wrongChoice(_,s,t,f,b,y,d,h,o,k,l,e),_+=1},r.append(f),r.append(b),r.append(y),c.append(u),c.append(g),p.append(w),p.append(v),n.append(r),n.append(d),n.append(o),this.stateGame.append(h),this.stateGame.append(c),this.stateGame.append(n),this.stateGame.append(p),this.stateGame}async rightChoice(t,e,s,a,i,n,o,l,r,d,h,p){const c=o,u=l,g=r,v=d;if(t<e.length){const o=this.findWord(s,e[t].en);o&&p&&await this.createNewUserWord(o,p),e[t].match?(o&&p&&(this.countBestRes+=1,this.bestResult.push(this.countBestRes),this.correctUserWord(o,p)),this.createSounds(this.sound,"true"),this.createCorrectResult(s,e[t].en),this.countResult(u,c),this.styleCrow([a,i,n])):(o&&p&&(this.bestResult.push(this.countBestRes),this.countBestRes=0,this.incorrectUserWord(o,p)),this.createSounds(this.sound,"false"),this.createWrongResult(s,e[t].en),this.pointsTotalResult=[],this.points=10,this.styleCrow([a,i,n],!0),c.innerHTML=`+${this.points} очков за слово`)}t<e.length-1&&(g.innerHTML=`${e[t+1].en}   -   ${e[t+1].ru}`,v.src=`${m}/${e[t+1].audio}`),t===e.length-1&&setTimeout((()=>{this.timeleft=0}),500),g.appendChild(h)}async wrongChoice(t,e,s,a,i,n,o,l,r,d,h,p){const c=o,u=l,g=r,v=d;if(t<e.length){const o=this.findWord(s,e[t].en);o&&p&&await this.createNewUserWord(o,p),e[t].match?(o&&p&&(this.bestResult.push(this.countBestRes),this.countBestRes=0,this.incorrectUserWord(o,p)),this.createSounds(this.sound,"false"),this.createWrongResult(s,e[t].en),this.pointsTotalResult=[],this.points=10,c.innerHTML=`+${this.points} очков за слово`,this.styleCrow([a,i,n],!0)):(o&&p&&(this.countBestRes+=1,this.bestResult.push(this.countBestRes),this.correctUserWord(o,p)),this.createSounds(this.sound,"true"),this.createCorrectResult(s,e[t].en),this.countResult(u,c),this.styleCrow([a,i,n]))}t<e.length-1&&(g.innerHTML=`${e[t+1].en}   -   ${e[t+1].ru}`,v.src=`${m}/${e[t+1].audio}`),t===e.length-1&&setTimeout((()=>{this.timeleft=0}),500),g.appendChild(h)}async createNewUserWord(t,e){const s=t;void 0===s.optional?.markedAsNew&&(s.difficulty="normal",s.optional={learned:"no",learnDate:Date.now(),games:{sprint:{wins:0,total:0},audio:{wins:0,total:0},phrase:{wins:0,total:0}},markedAsNew:!0},await f(e.id,s.id,e.token,{difficulty:s.difficulty,optional:s.optional})),!1===s.optional?.markedAsNew&&(s.optional.markedAsNew=!0,await y(e.id,s.id,e.token,{difficulty:s.difficulty,optional:s.optional}))}async correctUserWord(t,e){const s=t;await $.postCorrect(s),s.optional.games.sprint.wins+=1,s.optional.games.sprint.total+=1,("normal"===s.difficulty&&s.optional.games.sprint.wins%3==0||"difficult"===s.difficulty&&s.optional.games.sprint.wins%5==0)&&(s.difficulty="easy",s.optional.learned="yes",s.optional.learnDate=Date.now()),await y(e.id,s.id,e.token,{difficulty:s.difficulty,optional:s.optional})}async incorrectUserWord(t,e){const s=t;await $.postWrong(s),s.optional.games.sprint.total+=1,"yes"===s.optional.learned&&(s.difficulty="normal",s.optional.learned="no",s.optional.learnDate=Date.now()),await y(e.id,s.id,e.token,{difficulty:s.difficulty,optional:s.optional})}endGame(){$.postBestSeries(Math.max(...this.bestResult)),this.stateGame.innerHTML="";const t=a("div","sprint_over card"),e=a("div","sprint_result"),s=a("div","sprint_show-resultexperience"),i=new Audio("./assets/audio/over.mp3"),n=a("ul","sprint_list-words"),o=a("ul","sprint_list-words"),l=a("div","sprint_header-result"),r=a("ul","sprint_all-words"),d=this.learnedWords.map((t=>JSON.stringify(t))),h=[...new Set(d)].map((t=>JSON.parse(t))),p=this.unlearnedWords.map((t=>JSON.stringify(t))),c=[...new Set(p)].map((t=>JSON.parse(t))),u=a("div","sprint_header-learn",`Угаданные слова - ${h.length}`),g=a("div","sprint_header-unlearn",`Слова с ошибками - ${c.length}`);e.innerHTML=`Набрано ${this.pointsTotal} очков`,s.innerHTML=`Получено +${h.length+c.length} опыта`;const v=a("div","sprint_btn-block-over"),w=a("button","waves-effect waves-light btn left-sptint-btn end","перейти в учебник");i.pause(),w.tabIndex=0,h.length&&Promise.all(h).then((t=>{for(let e=0;e<t.length;e+=1){const s=new Audio,i=a("i","tiny grey-text text-darken-2 material-icons volume-up sprint-audio","volume_up");i.onclick=()=>{s.play()};const o=a("li","sprint_list",`${t[e][0]} ${t[e][1]} - ${t[e][2]}`);s.src=`${m}/${t[e][3]}`,o.append(i),n.append(o)}})),c.length&&Promise.all(c).then((t=>{for(let e=0;e<t.length;e+=1){const s=new Audio,i=a("i","tiny grey-text text-darken-2 material-icons volume-up sprint-audio","volume_up");i.onclick=()=>{s.play()};const n=a("li","sprint_list",`${t[e][0]} ${t[e][1]} - ${t[e][2]}`);s.src=`${m}/${t[e][3]}`,n.append(i),o.append(n)}})),w.onclick=()=>{const t=window.location.hash.slice(1).split("#");void 0!==t[1]?window.location.hash=`book#${t[1]}#${t[2]}`:window.location.hash="book",this.stopGame()},this.sound&&i.play(),this.sound=!1,v.append(w),v.append(this.againGame),l.append(e),l.append(s),t.append(l),n.append(u),o.append(g),r.append(o),r.append(n),t.append(r),t.append(v),this.stateGame.append(t)}findWord(t,e){return t.find((t=>t.word===e))}createCorrectResult(t,e){t.filter((t=>t.word===e?this.learnedWords.push([t.word,t.transcription,t.wordTranslate,t.audio]):[]))}createWrongResult(t,e){t.filter((t=>t.word===e?this.unlearnedWords.push([t.word,t.transcription,t.wordTranslate,t.audio]):[]))}createSounds(t,e){const s=new Audio("./assets/audio/cool.mp3"),a=new Audio("./assets/audio/bug.mp3");t?("true"===e&&s.play(),"false"===e&&a.play()):(s.pause(),a.pause())}styleCrow(t,e){e?(t.forEach((t=>t.classList.remove("active"))),this.pointsResult=[]):(this.pointsResult.length&&t[this.pointsResult.length-1].classList.add("active"),1===this.pointsResult.length&&(t.forEach((t=>t.classList.remove("active"))),t[this.pointsResult.length-1].classList.add("active")))}countResult(t,e){const s=t,a=e;this.pointsResult.length>=3&&(this.pointsResult=[]),this.pointsTotalResult.push(this.points),this.pointsTotal+=this.points,3===this.pointsTotalResult.length&&(this.points=20),6===this.pointsTotalResult.length&&(this.points=40),9===this.pointsTotalResult.length&&(this.points=80),s.innerHTML=`${this.pointsTotal}`,this.pointsResult.push(this.points),a.innerHTML=`+${this.points} очков за слово`}stopGame(){this.sound=!0,this.fullscreen=!1,this.soundImg.classList.remove("sprint_not-sound"),this.bestResult=[0],this.countBestRes=0,clearInterval(this.downloadTimer),this.points=10,this.pointsTotal=0,this.pointsTotalResult=[],this.pointsResult=[],this.learnedWords=[],this.unlearnedWords=[],window.removeEventListener("keyup",this.handleKeypress),document.fullscreenElement&&document.exitFullscreen()}}class F{constructor(t){this.view=new O(t),this.model=new H}async show(t,e){const s=localStorage.getItem("user"),a=JSON.parse(localStorage.getItem("user"));if(void 0!==e&&void 0!==t)if(s&&6!==t){const s=await this.model.getGameData(e,t),i=await b(a.id,a.token),n=G(s,i).combinedArr.filter((t=>!t.optional||"no"===(t.optional&&t.optional).learned));this.view.render(n,a)}else if(s&&6===t){const t=C((await k(a.id,a.token))[0].paginatedResults);this.view.render(t,a)}else{const s=await this.model.getGameData(e,t);this.view.render(s)}else void 0!==e&&void 0!==t||(s?this.view.render(void 0,a):this.view.render())}stopGame(){this.view.stopGame()}}class j{async getGameData(t,e){return await w(t,e)}}class P{constructor(t){this.pressMainButtonAnswer=(t,e,s,a,i,n,o,l,r,d)=>{const h=i;t.innerText="ДАЛЬШЕ",this.renderWordCard(a,s,n,o),h.innerHTML="",o.appendChild(l),h.append(r),d.forEach((t=>{const i=t;i.textContent?.split(" ").slice(1).join(" ")===a[s].ru&&(i.classList.add("correct"),this.createWrongResult(e,a[s].en)),i.disabled=!0}))},this.pressMainButtonNext=(t,e,s,a,i,n,o)=>{const l=a,r=t;i.forEach((t=>{t.classList.remove("correct"),t.classList.remove("wrong"),t.disabled=!1})),r.innerText="НЕ ЗНАЮ",this.renderRandomWords(i,s,e,o),l.innerHTML="",l.append(n)},this.mainDiv=t,this.stateGame=a("div","audio_game-content"),this.controlBlock=a("div","audio_controll"),this.againGame=a("button","waves-effect waves-light btn right-audio-btn end","сыграть еще раз"),this.soundImg=a("button","audio_sound"),this.sound=!0,this.fullscreen=!1,this.points=10,this.pointsTotal=0,this.pointsTotalResult=[],this.pointsResult=[],this.learnedWords=[],this.unlearnedWords=[],this.audio=new Audio,this.countBestRes=0,this.bestResult=[0],this.handleVolumepress=()=>{},this.handleKeypress=()=>{},this.handleMainKeypress=()=>{},this.set1=setTimeout((()=>{})),this.set2=setTimeout((()=>{})),this.set3=setTimeout((()=>{})),this.set4=setTimeout((()=>{})),this.set5=setTimeout((()=>{})),this.set6=setTimeout((()=>{})),this.set7=setTimeout((()=>{})),this.set8=setTimeout((()=>{}))}render(t,e){this.controlBlock.innerHTML="",this.mainDiv.innerHTML="";const s=a("div","audio-game"),i=a("img","img-audio"),n=a("button","audio_fullscreen"),o=a("button","audio_cross");n.onclick=()=>{this.fullscreen?(document.exitFullscreen(),this.fullscreen=!1):(this.mainDiv.requestFullscreen(),this.fullscreen=!0)},this.soundImg.onclick=()=>{this.sound?(this.sound=!1,this.soundImg.classList.add("audio_not-sound")):(this.sound=!0,this.soundImg.classList.remove("audio_not-sound")),this.createSounds(this.sound)},o.onclick=()=>{window.location.hash="main",this.stopGame()},this.soundImg.onmouseout=()=>{this.soundImg.blur()},n.onmouseout=()=>{n.blur()},this.againGame.tabIndex=0,o.tabIndex=0,this.soundImg.tabIndex=0,n.tabIndex=0,s.append(i),this.controlBlock.appendChild(this.soundImg),this.controlBlock.append(n),this.controlBlock.appendChild(o),this.mainDiv.append(this.controlBlock),this.mainDiv.append(s),t&&e?(this.mainDiv.append(this.startGameFromBook(t,e)),this.againGame.onclick=()=>{this.stopGame(),this.startGameFromBook(t,e),this.sound=!0}):t&&!e?(this.mainDiv.append(this.startGameFromBook(t)),this.againGame.onclick=()=>{this.stopGame(),this.startGameFromBook(t),this.audio.remove(),this.sound=!0}):!t&&e?(this.mainDiv.append(this.startGameFromMenu(e)),this.againGame.onclick=()=>{this.stopGame(),this.startGameFromMenu(e),this.audio.remove(),this.sound=!0}):t||e||(this.mainDiv.append(this.startGameFromMenu()),this.againGame.onclick=()=>{this.stopGame(),this.startGameFromMenu(),this.audio.remove(),this.sound=!0})}startGameFromMenu(t){this.stateGame.innerHTML="",this.pointsResult=[],this.points=10,this.pointsTotal=0,this.learnedWords=[],this.unlearnedWords=[];const e=a("h1","title-audio h1-lang","Аудиовызов"),s=a("h5","subtitle-audio h5-lang","Попробуй угадать как можно больше слов на слух"),i=a("ul","nav-audio h6-lang","Инструкция для игры на клавиатуре:"),n=a("li","nav_list-audio ul-lang"," - цифровые клавиши от 1 до 5 для выбора ответа"),o=a("li","nav_list-audio ul-lang"," - клавиша Enter для подсказки или для перехода к следующему слову"),l=a("li","nav_list-audio ul-lang"," - пробел для повторного звучания слова"),r=a("div","level-audio"),d=["A1","A2","B1","B2","C1","C2"],h=["waves-purple violet-border","waves-yellow yellow-border","waves-green green-border","waves-teal blue-border","waves-orange orange-border","waves-red red-border"];for(let e=0;e<=5;e+=1){const s=a("button",`audio-level-btn z-depth-2 waves-effect ${h[e]}`,`${d[e]}`);s.disabled=!1,s.tabIndex=0,s.onclick=async()=>{s.disabled=!0;const a=Math.floor(29*Math.random()),i=await g(a,e);if(this.stateGame.innerHTML="",t){const e=await b(t.id,t.token),s=G(i,e).combinedArr;this.mainDiv.append(this.showGame(s,t))}else this.mainDiv.append(this.showGame(i))},r.append(s)}return i.append(n),i.append(o),i.append(l),this.stateGame.append(e),this.stateGame.append(s),this.stateGame.append(i),this.stateGame.append(r),this.stateGame}startGameFromBook(t,e){this.stateGame.innerHTML="",this.pointsResult=[],this.points=10,this.pointsTotal=0,this.learnedWords=[],this.unlearnedWords=[];const s=a("h1","title-audio h1-lang","Аудиовызов"),i=a("h5","subtitle-audio h5-lang","Попробуй угадать как можно больше слов на слух"),n=a("ul","nav-audio h6-lang","Инструкция для игры на клавиатуре:"),o=a("li","nav_list-audio ul-lang"," - цифровые клавиши от 1 до 5 для выбора ответа"),l=a("li","nav_list-audio ul-lang"," - клавиша Enter для подсказки или для перехода к следующему слову"),r=a("li","nav_list-audio ul-lang"," - пробел для повторного звучания слова"),d=a("button","audio_start-btn z-depth-1 waves-effect","НАЧАТЬ");d.tabIndex=0;const h=t.filter((t=>!t.optional||"no"===(t.optional&&t.optional).learned));return d.disabled=!1,d.onclick=()=>{d.disabled=!0,this.stateGame.innerHTML="",h.length||(window.location.hash="book"),h.length&&e&&this.showGame(h,e),h.length&&!e&&this.showGame(h)},n.append(o),n.append(l),n.append(r),this.stateGame.append(s),this.stateGame.append(i),this.stateGame.append(n),this.stateGame.append(d),this.stateGame}showGame(t,e){const s=(t=>{const e=t.map((e=>{const s=[e.wordTranslate];if(t.length>5)for(;s.length<5;){const e=Math.floor(Math.random()*t.length);s.includes(t[e].wordTranslate)||s.push(t[e].wordTranslate)}else for(;s.length<t.length;){const e=Math.floor(Math.random()*t.length);s.includes(t[e].wordTranslate)||s.push(t[e].wordTranslate)}return{image:e.image,audio:e.audio,en:e.word,tr:e.transcription,ru:e.wordTranslate,ruRandom:(a=s,a.sort((()=>Math.random()-.5)))};var a}));return e.length>=10?e.slice(0,10).sort((()=>Math.random()-.5)):e})(t),i=a("div","audio_game-container"),n=a("div","audio_line-result"),o=a("div","audio_line-inner"),l=a("div","audio_word card"),r=a("div","audio_word-name"),d=a("i","tiny grey-text text-darken-2 material-icons volume-up audio_game-audio","volume_up"),h=a("div","audio_btn-block"),p=a("button","audio_main-btn z-depth-1 waves-effect","НЕ ЗНАЮ"),c=a("div","audio_main-block"),u=a("i","tiny grey-text text-darken-2 material-icons volume-up audio_volume","volume_up"),g=a("div","audio_img-word");u.tabIndex=0;let v=0,w=100/s.length;g.style.backgroundImage=`url(${m}/${s[0].image})`,this.audio.src=`${m}/${s[v].audio}`,d.onclick=()=>{this.audio.play()},u.onclick=()=>{this.audio.play()},this.audio.play(),setTimeout((()=>{i.classList.add("stop")}),200),r.innerHTML=`${s[v].en}  ${s[v].tr}`;let f=!0,b=!0;const y=[];let k=["1","2","3","4","5"];s.length<5&&(k=k.slice(0,s.length));for(let t=0;t<s[v].ruRandom.length;t+=1){const e=a("button","audio_block-word z-depth-1 waves-effect",`${t+1} ${s[v].ruRandom[t]}`);e.id=`${t+1}`,y.push(e),h.append(e)}return this.handleVolumepress=t=>{"Space"===t.code&&this.audio.play(),v===s.length&&window.removeEventListener("keyup",this.handleVolumepress)},this.handleKeypress=a=>{v<=s.length?k.forEach((i=>{a.key===i&&(console.log(),y.forEach((i=>{i.textContent?.split(" ").slice(1).join(" ")===s[v].ru&&i.classList.add("correct");const n=i.textContent?.split(" ").slice(1).join(" ");if(b&&i.id===a.key){if(window.removeEventListener("keyup",this.handleKeypress),window.removeEventListener("keyup",this.handleMainKeypress),n!==s[v].ru){this.createWrongResult(t,s[v].en);const a=this.findWord(t,s[v].en);a&&e&&this.createNewUserWord(a,e),i.classList.add("wrong"),a&&e&&(this.bestResult.push(this.countBestRes),this.countBestRes=0,this.incorrectUserWord(a,e)),this.createSounds(this.sound,"false")}else{this.createCorrectResult(t,s[v].en);const a=this.findWord(t,s[v].en);a&&e&&(this.countBestRes+=1,this.bestResult.push(this.countBestRes),this.correctUserWord(a,e)),this.createSounds(this.sound,"true"),this.pointsTotal+=10}b=!1}this.set1=setTimeout((()=>{window.addEventListener("keyup",this.handleMainKeypress)}),800),this.set2=setTimeout((()=>{window.addEventListener("keyup",this.handleKeypress)}),3e3),p.innerText="ДАЛЬШЕ",c.innerHTML="",this.renderWordCard(s,v,g,r),c.innerHTML="",r.appendChild(d),c.append(l),f=!1,v===s.length&&(this.endGame(),v=0),y.forEach((t=>{t.disabled=!0}))})))})):window.removeEventListener("keyup",this.handleKeypress)},this.handleMainKeypress=a=>{if(p.disabled=!1,v<=s.length){if("Enter"===a.key)if(f){f=!1,this.set3=setTimeout((()=>{window.addEventListener("keyup",this.handleMainKeypress)}),0),this.pressMainButtonAnswer(p,t,v,s,c,g,r,d,l,y);const a=this.findWord(t,s[v].en);a&&e&&(this.bestResult.push(this.countBestRes),this.countBestRes=0,this.createNewUserWord(a,e),this.incorrectUserWord(a,e))}else v+=1,o.style.width=`${w}%`,w+=100/s.length,this.set4=setTimeout((()=>{window.addEventListener("keyup",this.handleKeypress),window.removeEventListener("keyup",this.handleMainKeypress)}),2e3),this.addAnimation(i,s,v),f=!0,b=!0,p.disabled=!0,setTimeout((()=>{this.pressMainButtonNext(p,v,s,c,y,u,this.audio),p.disabled=!1}),800);v===s.length&&(this.endGame(),window.removeEventListener("keyup",this.handleKeypress),window.removeEventListener("keyup",this.handleMainKeypress),v=0)}},setTimeout((()=>{p.disabled=!1}),500),p.disabled=!0,p.onclick=()=>{if(v<=s.length)if(f){f=!1,p.disabled=!1,this.pressMainButtonAnswer(p,t,v,s,c,g,r,d,l,y),window.removeEventListener("keyup",this.handleKeypress);const a=this.findWord(t,s[v].en);a&&e&&(this.bestResult.push(this.countBestRes),this.countBestRes=0,this.createNewUserWord(a,e),this.incorrectUserWord(a,e))}else v+=1,o.style.width=`${w}%`,w+=100/s.length,this.addAnimation(i,s,v),f=!0,b=!0,p.disabled=!0,this.set5=setTimeout((()=>{window.addEventListener("keyup",this.handleKeypress),this.pressMainButtonNext(p,v,s,c,y,u,this.audio),p.disabled=!1}),800);v===s.length&&(window.removeEventListener("keyup",this.handleKeypress),window.removeEventListener("keyup",this.handleMainKeypress),this.endGame(),this.stopGame(),v=0)},y.forEach((a=>{const i=a;i.onclick=()=>{y.forEach((t=>{const e=t;e.textContent?.split(" ").slice(1).join(" ")===s[v].ru&&t.classList.add("correct"),e.disabled=!0}));const a=i.textContent?.split(" ").slice(1).join(" ");if(b){const n=this.findWord(t,s[v].en);n&&e&&this.createNewUserWord(n,e),a!==s[v].ru?(i.classList.add("wrong"),n&&e&&(this.bestResult.push(this.countBestRes),this.countBestRes=0,this.incorrectUserWord(n,e)),this.createWrongResult(t,s[v].en),this.createSounds(this.sound,"false")):(n&&e&&(this.countBestRes+=1,this.bestResult.push(this.countBestRes),this.correctUserWord(n,e)),this.createCorrectResult(t,s[v].en),this.createSounds(this.sound,"true"),this.pointsTotal+=10),b=!1}p.disabled=!0,setTimeout((()=>{p.disabled=!1}),500),p.innerText="ДАЛЬШЕ",c.innerHTML="",this.renderWordCard(s,v,g,r),c.innerHTML="",r.appendChild(d),c.append(l),f=!1,v===s.length&&(this.endGame(),v=0)}})),p.onmouseout=()=>{p.blur()},window.addEventListener("keyup",this.handleKeypress),this.set6=setTimeout((()=>{window.addEventListener("keyup",this.handleMainKeypress)}),2300),window.addEventListener("keyup",this.handleVolumepress),n.append(o),r.appendChild(d),l.append(g),l.append(r),c.append(u),i.append(c),i.append(h),i.append(p),this.stateGame.append(n),this.stateGame.append(i),this.stateGame}addAnimation(t,e,s){const a=t;a.classList.remove("stop"),a.classList.add("move"),window.removeEventListener("keyup",this.handleMainKeypress),setTimeout((()=>{a.style.display="none",a.classList.remove("move")}),500),setTimeout((()=>{a.style.display="flex"}),700),setTimeout((()=>{a.classList.add("stop")}),1e3),this.set7=setTimeout((()=>{window.addEventListener("keyup",this.handleKeypress)}),2e3),this.set8=setTimeout((()=>{window.addEventListener("keyup",this.handleMainKeypress)}),2200),s===e.length&&(clearInterval(this.set7),clearInterval(this.set8),window.removeEventListener("keyup",this.handleMainKeypress),window.removeEventListener("keyup",this.handleMainKeypress))}renderRandomWords(t,e,s,a){const i=a;if(s>0&&s<e.length){for(let a=0;a<t.length;a+=1)t[a].innerHTML=`${a+1} ${e[s].ruRandom[a]}`;i.src=`${m}/${e[s].audio}`,this.audio.src=`${m}/${e[s].audio}`,this.audio.play()}}async createNewUserWord(t,e){const s=t;void 0===s.optional?.markedAsNew&&(s.difficulty="normal",s.optional={learned:"no",learnDate:Date.now(),games:{sprint:{wins:0,total:0},audio:{wins:0,total:0},phrase:{wins:0,total:0}},markedAsNew:!0},await f(e.id,s.id,e.token,{difficulty:s.difficulty,optional:s.optional})),!1===s.optional?.markedAsNew&&(s.optional.markedAsNew=!0,await y(e.id,s.id,e.token,{difficulty:s.difficulty,optional:s.optional}))}async correctUserWord(t,e){const s=t;await $.postCorrect(s),s.optional.games.audio.wins+=1,s.optional.games.audio.total+=1,("normal"===s.difficulty&&s.optional.games.audio.wins%3==0||"difficult"===s.difficulty&&s.optional.games.audio.wins%5==0)&&(s.difficulty="easy",s.optional.learned="yes",s.optional.learnDate=Date.now()),await y(e.id,s.id,e.token,{difficulty:s.difficulty,optional:s.optional})}async incorrectUserWord(t,e){const s=t;await $.postWrong(s),s.optional.games.audio.total+=1,"yes"===s.optional.learned&&(s.difficulty="normal",s.optional.learned="no",s.optional.learnDate=Date.now()),await y(e.id,s.id,e.token,{difficulty:s.difficulty,optional:s.optional})}renderWordCard(t,e,s,a){const i=a,n=s;this.audio.src=`${m}/${t[e].audio}`,n.style.backgroundImage=`url(${m}/${t[e].image})`,i.innerHTML=`${t[e].en}  ${t[e].tr}`}endGame(){$.postBestSeries(Math.max(...this.bestResult)),this.countBestRes=0,this.bestResult=[0],this.stateGame.innerHTML="";const t=a("div","sprint_over card"),e=a("div","sprint_result"),s=a("div","sprint_show-resultexperience"),i=new Audio("./assets/audio/over.mp3"),n=a("ul","sprint_list-words"),o=a("ul","sprint_list-words"),l=a("div","sprint_header-result"),r=a("ul","sprint_all-words"),d=this.learnedWords.map((t=>JSON.stringify(t))),h=[...new Set(d)].map((t=>JSON.parse(t))),p=this.unlearnedWords.map((t=>JSON.stringify(t))),c=[...new Set(p)].map((t=>JSON.parse(t))),u=a("div","sprint_header-learn",`Угаданные слова - ${h.length}`),g=a("div","sprint_header-unlearn",`Слова с ошибками - ${c.length}`);e.innerHTML=`Набрано ${this.pointsTotal} очков`,s.innerHTML=`Получено +${h.length+c.length} опыта`;const v=a("div","sprint_btn-block-over"),w=a("button","waves-effect waves-light btn left-sptint-btn end","перейти в учебник");i.pause(),w.tabIndex=0,h.length&&Promise.all(h).then((t=>{for(let e=0;e<t.length;e+=1){const s=new Audio,i=a("i","tiny grey-text text-darken-2 material-icons volume-up sprint-audio","volume_up");i.onclick=()=>{s.play()};const o=a("li","sprint_list",`${t[e][0]} ${t[e][1]} - ${t[e][2]}`);s.src=`${m}/${t[e][3]}`,o.append(i),n.append(o)}})),c.length&&Promise.all(c).then((t=>{for(let e=0;e<t.length;e+=1){const s=new Audio,i=a("i","tiny grey-text text-darken-2 material-icons volume-up sprint-audio","volume_up");i.onclick=()=>{s.play()};const n=a("li","sprint_list",`${t[e][0]} ${t[e][1]} - ${t[e][2]}`);s.src=`${m}/${t[e][3]}`,n.append(i),o.append(n)}})),w.onclick=()=>{const t=window.location.hash.slice(1).split("#");void 0!==t[1]?window.location.hash=`book#${t[1]}#${t[2]}`:window.location.hash="book",this.stopGame()},this.sound&&i.play(),this.sound=!1,v.append(w),v.append(this.againGame),l.append(e),l.append(s),t.append(l),n.append(u),o.append(g),r.append(o),r.append(n),t.append(r),t.append(v),this.stateGame.append(t)}createCorrectResult(t,e){t.filter((t=>t.word===e?this.learnedWords.push([t.word,t.transcription,t.wordTranslate,t.audio]):[]))}createWrongResult(t,e){t.filter((t=>t.word===e?this.unlearnedWords.push([t.word,t.transcription,t.wordTranslate,t.audio]):[]))}findWord(t,e){return t.find((t=>t.word===e))}createSounds(t,e){const s=new Audio("./assets/audio/cool.mp3"),a=new Audio("./assets/audio/bug.mp3");t?("true"===e&&s.play(),"false"===e&&a.play()):(s.pause(),a.pause())}stopGame(){this.sound=!0,this.audio.remove(),this.fullscreen=!1,this.soundImg.classList.remove("audio_not-sound"),this.countBestRes=0,this.bestResult=[0],this.points=10,this.pointsTotal=0,this.pointsTotalResult=[],this.pointsResult=[],this.learnedWords=[],this.unlearnedWords=[],clearInterval(this.set1),clearInterval(this.set2),clearInterval(this.set3),clearInterval(this.set4),clearInterval(this.set5),clearInterval(this.set6),clearInterval(this.set7),clearInterval(this.set8),window.removeEventListener("keyup",this.handleMainKeypress),window.removeEventListener("keyup",this.handleKeypress),window.removeEventListener("keyup",this.handleVolumepress),document.fullscreenElement&&document.exitFullscreen()}}class z{constructor(t){this.view=new P(t),this.model=new j}async show(t,e){const s=localStorage.getItem("user"),a=JSON.parse(localStorage.getItem("user"));if(void 0!==e&&void 0!==t)if(s&&6!==t){const s=await this.model.getGameData(e,t),i=await b(a.id,a.token),n=G(s,i).combinedArr.filter((t=>!t.optional||"no"===(t.optional&&t.optional).learned));this.view.render(n,a)}else if(s&&6===t){const t=C((await k(a.id,a.token))[0].paginatedResults);this.view.render(t,a)}else{const s=await this.model.getGameData(e,t);this.view.render(s)}else void 0!==e&&void 0!==t||(s?this.view.render(void 0,a):this.view.render())}stopGame(){this.view.stopGame()}}class U{async getGameData(t,e){return await w(t,e)}}class K{constructor(t,e,s,i){const n=e.replace("</b>","<b>").split("<b>");this.phraseWrap=a("div","z-depth-2 phrase-wrap"),t.appendChild(this.phraseWrap),this.textExampleWrap=a("div","text-example-wrap"),this.phraseWrap.appendChild(this.textExampleWrap),this.numPart=a("div","",`${i+1}.`),this.textExampleWrap.appendChild(this.numPart),this.firstPart=a("div","",`${n[0]}`),this.textExampleWrap.appendChild(this.firstPart),this.back=a("div","back"),this.textExampleWrap.appendChild(this.back),this.back.setAttribute("data-numb",`${i}`),this.secondPart=a("div","",`${n[2]}`),this.textExampleWrap.appendChild(this.secondPart),this.wordWrap=a("div","word-wrap"),this.phraseWrap.appendChild(this.wordWrap),this.backStart=a("div","back back-start"),this.wordWrap.appendChild(this.backStart),this.item=a("div","item z-depth-3",`${s.word}`),this.backStart.append(this.item),this.item.draggable=!0,this.item.setAttribute("data-numb",`${s.numb}`),this.setListeners()}setListeners(){this.back.ondragenter=()=>this.onDragenter?.(),this.back.ondragleave=()=>this.onDragleave?.(),this.back.ondrop=async()=>this.onDrop?.(),this.back.addEventListener("dragover",(t=>t.preventDefault())),this.backStart.ondragenter=()=>this.onDragenterS?.(),this.backStart.ondragleave=()=>this.onDragleaveS?.(),this.backStart.ondrop=()=>this.onDropS?.(),this.backStart.addEventListener("dragover",(t=>t.preventDefault())),this.item.ondragstart=()=>this.onDragstart?.(),this.item.ondragend=()=>this.onDragend?.()}}class V{constructor(t){this.sendInfoToServer=async(t,e,s)=>{await $.postPhraseResults(t,e),await Promise.all(t.map((t=>{const e=t;return e.difficulty?("difficult"===e.difficulty&&(e.optional.games.phrase.wins+1)%5==0&&(e.difficulty="easy",e.optional.learned="yes",e.optional.learnDate=Date.now()),"normal"===e.difficulty&&(e.optional.games.phrase.wins+1)%3==0&&(e.difficulty="easy",e.optional.learned="yes",e.optional.learnDate=Date.now()),e.optional.markedAsNew=!0,e.optional.games.phrase.total+=1,e.optional.games.phrase.wins+=1,y(s.id,e.id,s.token,{difficulty:e.difficulty,optional:e.optional})):(e.difficulty="normal",e.optional={learned:"no",learnDate:Date.now(),games:{sprint:{wins:0,total:0},audio:{wins:0,total:0},phrase:{wins:1,total:1}},markedAsNew:!0},f(s.id,e.id,s.token,{difficulty:e.difficulty,optional:e.optional}))}))),await Promise.all(e.map((t=>{const e=t;return e.difficulty?("yes"===e.optional.learned&&(e.difficulty="normal",e.optional.learned="no",e.optional.learnDate=Date.now()),e.optional.markedAsNew=!0,e.optional.games.phrase.total+=1,y(s.id,e.id,s.token,{difficulty:e.difficulty,optional:e.optional})):(e.difficulty="normal",e.optional={learned:"no",learnDate:Date.now(),games:{sprint:{wins:0,total:0},audio:{wins:0,total:0},phrase:{wins:0,total:1}},markedAsNew:!0},f(s.id,e.id,s.token,{difficulty:e.difficulty,optional:e.optional}))})))},this.mainDiv=t,this.stateGame=a("div","phrase_game-content z-depth-2"),this.controlBlock=a("div","phrase_controll"),this.soundImg=a("button","phrase_sound"),this.againGame=a("button","waves-effect waves-light btn right-phrase-btn end","сыграть еще раз"),this.sound=!0,this.fullscreen=!1,this.points=10,this.pointsTotal=0,this.pointsTotalResult=[],this.pointsResult=[],this.learnedWords=[],this.unlearnedWords=[]}render(t,e){this.controlBlock.innerHTML="",this.mainDiv.innerHTML="";const s=a("div","phrase-game"),i=a("div","img-phrase"),n=a("button","phrase_fullscreen"),o=a("button","phrase_cross");this.sound=!0,this.soundImg.classList.remove("phrase_not-sound"),n.onclick=()=>{this.fullscreen?(document.exitFullscreen(),this.fullscreen=!1):(this.mainDiv.requestFullscreen(),this.fullscreen=!0)},this.soundImg.onclick=()=>{this.sound?(this.sound=!1,this.soundImg.classList.add("phrase_not-sound")):(this.sound=!0,this.soundImg.classList.remove("phrase_not-sound"))},o.onclick=()=>{window.location.hash="main",this.stopGame()},this.soundImg.onmouseout=()=>{this.soundImg.blur()},n.onmouseout=()=>{n.blur()},this.againGame.tabIndex=0,o.tabIndex=0,this.soundImg.tabIndex=0,n.tabIndex=0,s.append(i),this.controlBlock.appendChild(this.soundImg),this.controlBlock.append(n),this.controlBlock.appendChild(o),this.mainDiv.append(this.controlBlock),this.mainDiv.append(s),t&&e?(this.mainDiv.append(this.startGameFromBook(t,e)),this.againGame.onclick=()=>{this.startGameFromBook(t,e)}):t&&!e?(this.mainDiv.append(this.startGameFromBook(t)),this.againGame.onclick=()=>{this.startGameFromBook(t)}):!t&&e?(this.mainDiv.append(this.startGameFromMenu(e)),this.againGame.onclick=()=>{this.startGameFromMenu(e)}):t||e||(this.mainDiv.append(this.startGameFromMenu()),this.againGame.onclick=()=>{this.startGameFromMenu()})}startGameFromMenu(t){this.stateGame.innerHTML="",this.pointsResult=[],this.points=10,this.pointsTotal=0,this.learnedWords=[],this.unlearnedWords=[];const e=a("h1","title-phrase h1-lang","Фразы"),s=a("h5","subtitle-phrase h5-lang center","Соедини слова и фразы в правильном порядке"),i=a("div","level-phrase"),n=["A1","A2","B1","B2","C1","C2"],o=["waves-purple violet-border","waves-yellow yellow-border","waves-green green-border","waves-teal blue-border","waves-orange orange-border","waves-red red-border"];for(let e=0;e<=5;e+=1){const s=a("button",`phrase-level-btn z-depth-2 waves-effect ${o[e]}`,`${n[e]}`);s.disabled=!1,s.tabIndex=0,s.onclick=async()=>{s.disabled=!0;const a=Math.floor(29*Math.random()),i=await w(a,e);if(this.stateGame.innerHTML="",t){const e=await b(t.id,t.token),s=G(i,e).combinedArr;this.mainDiv.append(this.showGame(s,t))}else this.mainDiv.append(this.showGame(i))},i.append(s)}return this.stateGame.append(e),this.stateGame.append(s),this.stateGame.append(i),this.stateGame}startGameFromBook(t,e){this.stateGame.innerHTML="",this.pointsResult=[],this.points=10,this.pointsTotal=0,this.learnedWords=[],this.unlearnedWords=[];const s=a("h1","title-phrase h1-lang","Фразы"),i=a("h5","subtitle-phrase h5-lang","Соедини слова и фразы в правильном порядке"),n=a("button","phrase_start-btn z-depth-1 waves-effect","НАЧАТЬ");n.tabIndex=0;const o=t.filter((t=>!t.optional||"no"===(t.optional&&t.optional).learned));return n.disabled=!1,n.onclick=()=>{n.disabled=!0,this.stateGame.innerHTML="",e?this.showGame(o,e):this.showGame(o)},this.stateGame.append(s),this.stateGame.append(i),this.stateGame.append(n),this.stateGame}showGame(t,e){if(t.length<10){const t=a("p","no-words-card","Недостаточно слов для игры! :)\n Попробуйте зайти с другой страницы");this.stateGame.appendChild(t);const e=a("a","btn-large waves-effect waves-light grey lighten-3 z-depth-3 btn-lang","Назад");return e.onclick=()=>window.history.back(),this.stateGame.appendChild(e),this.stateGame}const s=(t=>{const e=[],s=[...Array(t.length).keys()];for(let a=0;a<10;a+=1){const a=Math.floor(Math.random()*s.length);e.push(t[s[a]]),s.splice(a,1)}return e})(t),i=a("h5","h5-lang phrase-all-title center","Перетяни слова в правильные фразы");this.stateGame.appendChild(i);const n=a("div","phrase-all-wrap");this.stateGame.appendChild(n);const o=[],l=new Array(10);l.fill(void 0);for(let t=0;t<s.length;t+=1){const e=s[t].textExample.replace("</b>","<b>").split("<b>");o.push({numb:t,word:e[1].toLowerCase()})}const r=(t=>{const e=[],s=[...Array(t.length).keys()];for(let a=0;a<10;a+=1){const a=Math.floor(Math.random()*s.length);e.push(t[s[a]]),s.splice(a,1)}return e})(o);for(let t=0;t<s.length;t+=1){const a=new K(n,s[t].textExample,r[t],t);a.onDragenter=()=>a.back.classList.add("hovered"),a.onDragleave=()=>a.back.classList.remove("hovered"),a.onDrop=async()=>{if(this.itemT){const t=Number(a.back.getAttribute("data-numb")),e=Number(this.itemT.getAttribute("data-numb"));if(void 0===l[t]){for(let t=0;t<l.length;t+=1)l[t]===e&&(l[t]=void 0);l[t]=e,a.back.append(this.itemT),this.createSounds(this.sound)}}if(a.back.classList.remove("hovered"),10===l.filter((t=>void 0!==t)).length){const t=l.filter(((t,e)=>t===e)),a=l.filter(((t,e)=>t!==e)),i=s.filter(((e,s)=>t.includes(s))),n=s.filter(((t,e)=>a.includes(e)));e&&await this.sendInfoToServer(i,n,e),this.endGame(i,n)}},a.onDragenterS=()=>a.backStart.classList.add("hovered"),a.onDragleaveS=()=>a.backStart.classList.remove("hovered"),a.onDropS=()=>{if(!a.backStart.firstElementChild){if(this.itemT){const t=Number(this.itemT.getAttribute("data-numb"));for(let e=0;e<l.length;e+=1)l[e]===t&&(l[e]=void 0);a.backStart.append(this.itemT)}a.backStart.classList.remove("hovered")}},a.onDragstart=()=>{this.itemT=a.item,a.item.classList.add("hold"),setTimeout((()=>a.item.classList.add("hide")),0)},a.onDragend=()=>a.item.classList.remove("hide","hold")}return this.stateGame}endGame(t,e){this.stateGame.innerHTML="";const s=a("div","phrase_over card"),i=a("div","sprint_result"),n=a("div","sprint_show-resultexperience"),o=new Audio("./assets/audio/over.mp3"),l=a("ul","phrase_list-words"),r=a("ul","phrase_list-words"),d=a("div","phrase_header-result"),h=a("ul","phrase_all-words"),p=a("div","phrase_header-learn",`Угаданные слова - ${t.length}`),c=a("div","phrase_header-unlearn",`Слова с ошибками - ${e.length}`);l.append(p),r.append(c),i.innerHTML=`Набрано ${10*t.length} очков`,n.innerHTML="Получено +10 опыта";const u=a("div","phrase_btn-block-over"),g=a("button","waves-effect waves-light btn left-sptint-btn end","перейти в учебник");o.pause(),g.tabIndex=0;for(let e=0;e<t.length;e+=1){const s=new Audio,i=a("i","tiny grey-text text-darken-2 material-icons volume-up sprint-phrase","volume_up");i.onclick=()=>{s.play()};const n=a("li","sprint_list",`${t[e].word} ${t[e].transcription} - ${t[e].wordTranslate}`);s.src=`${m}/${t[e].audio}`,n.append(i),l.append(n)}for(let t=0;t<e.length;t+=1){const s=new Audio,i=a("i","tiny grey-text text-darken-2 material-icons volume-up sprint-phrase","volume_up");i.onclick=()=>{s.play()};const n=a("li","sprint_list",`${e[t].word} ${e[t].transcription} - ${e[t].wordTranslate}`);s.src=`${m}/${e[t].audio}`,n.append(i),r.append(n)}g.onclick=()=>{const t=window.location.hash.slice(1).split("#");void 0!==t[1]?window.location.hash=`book#${t[1]}#${t[2]}`:window.location.hash="book",this.stopGame()},this.sound&&o.play(),u.append(g),u.append(this.againGame),d.append(i),d.append(n),s.append(d),h.append(r),h.append(l),s.append(h),s.append(u),this.stateGame.append(s)}createSounds(t){const e=new Audio("./assets/audio/card-on-place-1.mp3");t?e.play():e.pause()}stopGame(){this.sound=!0,this.soundImg.classList.remove("phrase_not-sound"),this.fullscreen=!1,this.points=10,this.pointsTotal=0,this.pointsTotalResult=[],this.pointsResult=[],this.learnedWords=[],this.unlearnedWords=[],document.fullscreenElement&&document.exitFullscreen()}}class J{constructor(t){this.view=new V(t),this.model=new U}async show(t,e){const s=localStorage.getItem("user"),a=JSON.parse(localStorage.getItem("user"));if(void 0!==e&&void 0!==t)if(s&&6!==t){const s=await this.model.getGameData(e,t),i=await b(a.id,a.token),n=G(s,i).combinedArr.filter((t=>!t.optional||"no"===(t.optional&&t.optional).learned));this.view.render(n,a)}else if(s&&6===t){const t=C((await k(a.id,a.token))[0].paginatedResults);this.view.render(t,a)}else{const s=await this.model.getGameData(e,t);this.view.render(s)}else void 0!==e&&void 0!==t||(s?this.view.render(void 0,a):this.view.render())}stopGame(){this.view.stopGame()}}var q=s(678);class Z{constructor(t){this.mainDiv=t}render(t){const e=(()=>{const t=a("div","parallax-container valign-wrapper top-img-stat","","index-banner");return t.innerHTML='\n  <div class="section no-pad-bot ">\n    <div class="container">\n      <h4 class="header center white-text h4-lang">Статистика за сегодня</h4>\n    </div>\n  </div>\n\n  <div class="parallax">\n    <img src="assets/images/stat/circles-1.jpg" alt="circles" class = "img-parallax">\n  </div>\n  ',t})(),s=(t=>{const e=a("div","container scrollspy","","day-stat"),{today:s,long:i,dateToday:n}=t.optional,{sprint:o,audio:l,phrase:r}=s,d=`${Math.round(o.wins/o.total*100)||0}%`,h=`${Math.round(l.wins/l.total*100)||0}%`,p=`${Math.round(r.wins/r.total*100)||0}%`,c=o.wins+l.wins+r.wins,u=o.total+l.total+r.total,m=`${Math.round(c/u*100)||0}%`,g=i[n].newWords,v=i[n].learnedWords;return e.innerHTML=`\n  <div class="center stat-day-wrap section-stat">\n    <div class = "card z-depth-2 center stat-day">\n\n      <div class="stat_card stat_card_total">\n        <div class="stat_card_heading">\n          <span class="stat_card_img"><div class="game-picture stat_btn-total"></div></span>\n          <span class="stat_card_title">Итого по словам</span>\n        </div>\n        <div class="stats_list">\n          <div class="stat_text_container"><span>Изученных слов</span><span class="stat_num orange-text text-darken-3">${v}</span></div>\n          <div class="stat_text_container"><span>Новых слов</span><span class="stat_num">${g}</span></div>\n          <div class="stat_text_container"><span>Правильных ответов</span><span class="stat_num">${m}</span></div>\n        </div>\n      </div>\n      <div class="stat_card">\n        <div class="stat_card_heading">\n          <span class="stat_card_img"><div class="game-picture btn-sprint"></div></span>\n          <span class="stat_card_title">Спринт</span>\n        </div>\n        <div class="stats_list">\n        <div class="stat_text_container"><span>Лучшая серия</span><span class="stat_num light-green-text text-darken-3">${o.bestSeries}</span></div>\n        <div class="stat_text_container"><span>Новых слов</span><span class="stat_num">${o.newWords}</span></div>\n        <div class="stat_text_container"><span>Правильных ответов</span><span class="stat_num">${d}</span></div>\n        </div>\n      </div>\n      <div class="stat_card">\n        <div class="stat_card_heading">\n          <span class="stat_card_img"><div class="game-picture btn-audio"></div></span>\n          <span class="stat_card_title">Аудио-Вызов</span>\n        </div>\n        <div class="stats_list">\n        <div class="stat_text_container"><span>Лучшая серия</span><span class="stat_num light-green-text text-darken-3">${l.bestSeries}</span></div>\n          <div class="stat_text_container"><span>Новых слов</span><span class="stat_num">${l.newWords}</span></div>\n          <div class="stat_text_container"><span>Правильных ответов</span><span class="stat_num">${h}</span></div>\n        </div>\n      </div>\n      <div class="stat_card">\n        <div class="stat_card_heading">\n          <span class="stat_card_img"><div class="game-picture btn-collection"></div></span>\n          <span class="stat_card_title">Фразы</span>\n        </div>\n        <div class="stats_list">\n        <div class="stat_text_container"><span>Лучшая серия</span><span class="stat_num light-green-text text-darken-3">${r.bestSeries}</span></div>\n          <div class="stat_text_container"><span>Новых слов</span><span class="stat_num">${r.newWords}</span></div>\n          <div class="stat_text_container"><span>Правильных ответов</span><span class="stat_num">${p}</span></div>\n        </div>\n      </div>\n     \n    </div>\n  </div>\n  `,e})(t),i=(()=>{const t=a("div","parallax-container valign-wrapper center-img-stat");return t.innerHTML='\n  <div class="section no-pad-bot">\n    <div class="container">\n      <div class="row center">\n        <h4 class="header center white-text h4-lang">Статистика за все время</h4>\n      </div>\n    </div>\n  </div>\n  <div class="parallax">\n    <img src="assets/images/stat/houses.jpg" alt="big ben" class = "img-parallax">\n  </div>\n  ',t})(),n=(()=>{const t=a("div","container scrollspy","","all-stat");return t.innerHTML='\n  <div class="center stat-day-wrap section-stat">\n    <div class = "card z-depth-2 center stat-day">\n\n      <div class="stats_charts_container">\n        <h4 class="stat_long_heading">Новых (уникальных) слов по дням</h4>\n        <div id="stats_bar_chart" class="stats_chart"></div>\n        <h4 class="stat_long_heading">Всего изучено слов (прогресс)</h4>\n        <div id="stats_line_chart" class="stats_chart"></div>\n      </div>\n\n    </div>\n  </div>\n  ',t})(),o=(()=>{const t=a("div","parallax-container valign-wrapper");return t.innerHTML='\n  <div class="section no-pad-bot">\n    <div class="container">\n      <div class="row center">\n        <h5 class="header light h5-lang">А теперь на тренировку :)</h5>\n      </div>\n    </div>\n  </div>\n  <div class="parallax">\n    <img src="assets/images/stat/hogwards.jpg" alt="castle" class = "img-parallax">\n  </div>\n  ',t})(),l=(()=>{const t=a("div","col m3 l2 scroll-stat");return t.innerHTML='\n  <ul class="section table-of-contents">\n    <li><a href="#day-stat">За сегодня</a></li>\n    <li><a href="#all-stat">За все время</a></li>\n  </ul>\n  ',t})();this.mainDiv.innerHTML="",this.mainDiv.append(e,s,i,n,o,l);const r=this.sortLongStatsToArr(t),d=this.makeLabels(r),h=this.generateLabelIdsToShow(d),p=this.makeBarGraphData(r),c=this.makeLineGraphData(r);this.activateBarChart(d,p,h),this.activateLineChart(d,c,h)}showNeedToRegisterModal(){const t=a("div","stat_modal"),e=a("h6","stat_modal_title","Статистика доступна только \n        зарегистрированным пользователям");t.append(e),this.mainDiv.prepend(t)}sortLongStatsToArr(t){const{long:e}=t.optional,s=Object.entries(e);function a(t){const e=t.split("."),s=Number(e[0]),a=Number(e[1]);return 12*Number(e[2])*31+31*a+s}return s.sort(((t,e)=>a(t[0])-a(e[0]))),s}makeLabels(t){return t.map((t=>function(t){const e=t.split("."),s=e[0].length>1?e[0]:`0${e[0]}`,a=e[1].length>1?e[1]:`0${e[1]}`;return e[0]=s,e[1]=a,e.join(".")}(t[0])))}makeBarGraphData(t){return t.map((t=>t[1].newWords))}makeLineGraphData(t){const e=t.map((t=>t[1].learnedWords)),s=[];return e.forEach(((t,e)=>{0===e?s.push(t):s.push(t+s.at(-1))})),s}generateLabelIdsToShow(t){const e=t.length;if(e<=7)return Array(e).fill(0).map(((t,e)=>e));const s=Math.ceil(e/7);return t.map(((t,e)=>e%s==0?e:"")).filter((t=>""!==t))}activateBarChart(t,e,s){new q.vz("#stats_bar_chart",{labels:t,series:e},{distributeSeries:!0,chartPadding:{right:50},axisX:{labelInterpolationFnc:(t,e)=>s.includes(e)?t:null}})}activateLineChart(t,e,s){const a=new q.wW("#stats_line_chart",{labels:t,series:[e]},{fullWidth:!0,chartPadding:{right:50},axisX:{labelInterpolationFnc:(t,e)=>s.includes(e)?t:null}});let i,n=0;a.on("created",(()=>{n=0})),a.on("draw",(t=>{"point"===t.type&&t.element.animate({opacity:{begin:n+=80,dur:500,from:0,to:1},x1:{begin:n+=80,dur:500,from:t.x-100,to:t.x,easing:q.Z5.easeOutQuart}})})),a.on("created",(()=>{i&&clearTimeout(i),i=setTimeout(a.update.bind(a),8e3)}))}}class Q{constructor(t){this.model=$,this.view=new Z(t)}async show(){let t;if(localStorage.getItem("user"))t=await this.model.getStats(),this.handleEmptyStats(t),this.view.render(t);else{t=this.model.getDefaultStats();const e="Нет данных - нужно Войти ;)";M.toast({html:e}),this.view.render(t),this.view.showNeedToRegisterModal()}}handleEmptyStats(t){const e=Object.values(t.optional.long),{length:s}=e,{newWords:a,learnedWords:i}=e[0];if(1===s&&0===a&&0===i){const t="Рано ты - сначала поиграй ;)";M.toast({html:t})}}}(new class{constructor(){this.loader=B,this.prevRoute="",this.mainDiv=a("main"),this.appView=new p(this.mainDiv),this.main=new u(this.mainDiv),this.login=new E(this.mainDiv),this.book=new S(this.mainDiv),this.audio=new z(this.mainDiv),this.sprint=new F(this.mainDiv),this.phrase=new J(this.mainDiv),this.stats=new Q(this.mainDiv)}async start(){const[t,e,s]=window.location.hash.slice(1).split("#");this.appView.render(t),this.loader.init(),this.enableRouting(),this.updateLoginStatusOnFocus(),this.prevRoute=t,await this.renderNewPage([t,e,s])}enableRouting(){window.addEventListener("hashchange",(()=>{const[t,e,s]=window.location.hash.slice(1).split("#");this.prevRoute===i.sprint&&this.sprint.stopGame(),this.prevRoute===i.audio&&this.audio.stopGame(),this.prevRoute===i.book&&t!==i.book&&this.appView.cleanAppBody(),this.prevRoute=t,this.renderNewPage([t,e,s])}))}async renderNewPage([t,e="",s=""]){this.loader.show();const a=await this.login.updateLoginStatus();this.appView.updateLoginBtnText(a),t===i.login||t===i.register?this.login.show(t):t===i.book?""!==e?await this.book.show(Number(e),Number(s)):await this.book.show(0,0):t===i.audio?""!==e?await this.audio.show(Number(e),Number(s)):await this.audio.show():t===i.sprint?""!==e?await this.sprint.show(Number(e),Number(s)):await this.sprint.show():t===i.phrase?""!==e?await this.phrase.show(Number(e),Number(s)):await this.phrase.show():t===i.stats?await this.stats.show():this.main.show(),this.handleFooter(t),this.loader.hide(),document.documentElement.scrollTop=0,M.AutoInit()}updateLoginStatusOnFocus(){window.addEventListener("focus",(async()=>{this.loader.show();const t=await this.login.updateLoginStatus();this.appView.updateLoginBtnText(t),this.loader.hide()}))}handleFooter(t){["sprint","audio","phrase"].includes(t)?this.appView.hideFooter():this.appView.showFooter()}}).start()}},s={};function a(t){var i=s[t];if(void 0!==i)return i.exports;var n=s[t]={exports:{}};return e[t].call(n.exports,n,n.exports,a),n.exports}a.m=e,t=[],a.O=(e,s,i,n)=>{if(!s){var o=1/0;for(h=0;h<t.length;h++){for(var[s,i,n]=t[h],l=!0,r=0;r<s.length;r++)(!1&n||o>=n)&&Object.keys(a.O).every((t=>a.O[t](s[r])))?s.splice(r--,1):(l=!1,n<o&&(o=n));if(l){t.splice(h--,1);var d=i();void 0!==d&&(e=d)}}return e}n=n||0;for(var h=t.length;h>0&&t[h-1][2]>n;h--)t[h]=t[h-1];t[h]=[s,i,n]},a.d=(t,e)=>{for(var s in e)a.o(e,s)&&!a.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={179:0};a.O.j=e=>0===t[e];var e=(e,s)=>{var i,n,[o,l,r]=s,d=0;if(o.some((e=>0!==t[e]))){for(i in l)a.o(l,i)&&(a.m[i]=l[i]);if(r)var h=r(a)}for(e&&e(s);d<o.length;d++)n=o[d],a.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return a.O(h)},s=self.webpackChunkwebpack_build=self.webpackChunkwebpack_build||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})();var i=a.O(void 0,[46],(()=>a(470)));i=a.O(i)})();